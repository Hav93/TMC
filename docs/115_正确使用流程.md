# 115网盘正确使用流程

> **更新日期**：2025-10-17  
> **版本**：v2.0（全新设计）

---

## 📋 快速开始

### 方式一：纯Cookie模式（推荐新手）

```
1. 扫码登录
   ↓
2. ✅ 完成！可以使用115所有基础功能
```

**特点**：
- ✅ 简单快速
- ✅ 不需要申请AppID
- ⚠️ Cookie约30天过期

---

### 方式二：开放平台模式（推荐高级用户）

```
1. 扫码登录（获取Cookie）
   ↓
2. 填写AppID
   ↓
3. 点击"启用OPENAPI"
   ↓
4. ✅ 完成！获得更稳定的API访问
```

**特点**：
- ✅ API更稳定
- ✅ access_token自动刷新
- ✅ 更高的请求配额
- ⚠️ 需要申请AppID（白名单制）

---

## 🔄 详细流程图

### 纯Cookie模式流程

```
┌─────────────────────┐
│ 用户打开115设置页面  │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 选择设备类型         │
│ （推荐：115生活）    │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 点击"扫码登录"       │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 显示二维码Modal      │
│ （纯Cookie模式）     │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 用户用APP扫码        │
│ 并确认登录           │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 后端获取Cookie       │
│ 保存到数据库+文件    │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 刷新用户信息         │
│ （使用Cookie）       │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ ✅ 登录成功          │
│ 显示用户信息         │
└─────────────────────┘
```

---

### 开放平台激活流程

```
┌─────────────────────┐
│ 前置条件：           │
│ 已完成扫码登录       │
│ （有有效的Cookie）   │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 填写AppID            │
│ （例如：100195193）  │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 点击"启用OPENAPI"    │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 后端使用Cookie+AppID │
│ 请求access_token     │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 115验证Cookie有效性  │
└──────────┬──────────┘
           │
           ├─ Cookie有效 ──▶ 返回access_token
           │
           └─ Cookie无效 ──▶ 返回302（需要重新登录）
           
           │
           ▼
┌─────────────────────┐
│ 保存access_token     │
│ 到数据库             │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 使用access_token     │
│ 刷新用户信息         │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ ✅ 激活成功          │
│ 显示"已激活"状态     │
└─────────────────────┘
```

---

## ⚠️ 重要说明

### 为什么要分离扫码登录和开放平台激活？

**之前的设计问题**：
- 扫码时检测到AppID，自动使用开放平台二维码
- 用户不清楚自己在登录什么
- 如果激活失败，Cookie也被消耗了

**现在的设计优势**：
- ✅ **职责分离**：扫码登录只负责获取Cookie
- ✅ **用户可控**：用户明确知道何时激活开放平台
- ✅ **容错更好**：激活失败不影响基础Cookie功能
- ✅ **流程清晰**：先登录，后激活，逻辑简单

### Cookie过期了怎么办？

**症状**：
- 点击"启用OPENAPI"返回错误：`登录凭证已过期`
- 空间信息显示0B

**解决方案**：
1. 重新点击"扫码登录"
2. 扫码确认
3. 登录成功后，再点击"启用OPENAPI"

---

## 🔍 故障排查

### 问题1：扫码登录失败

**可能原因**：
- 二维码已过期（5分钟）
- 网络问题
- 使用了错误的APP

**解决方案**：
- 关闭Modal，重新点击"扫码登录"
- 确保使用115官方APP
- 检查网络连接

---

### 问题2：激活OPENAPI失败

**错误信息**：`登录凭证已过期，请重新扫码登录`

**原因**：Cookie已过期或无效

**解决方案**：
1. 先重新扫码登录（获取新Cookie）
2. 再点击"启用OPENAPI"

---

**错误信息**：`激活失败: HTTP 302`

**原因**：Cookie无效或AppID不正确

**解决方案**：
1. 检查AppID是否正确
2. 重新扫码登录
3. 再次尝试激活

---

### 问题3：空间信息显示0B

**可能原因**：
- Cookie模式下API限流（最常见）
- 信息未刷新

**解决方案**：
1. 等待30秒，点击"刷新用户信息"
2. 如果有AppID，激活OPENAPI后会更稳定
3. 空间信息为0不影响上传功能

---

## 📊 两种模式对比

| 特性 | Cookie模式 | OpenAPI模式 |
|------|-----------|------------|
| **设置难度** | ⭐ 简单 | ⭐⭐ 中等 |
| **需要AppID** | ❌ 不需要 | ✅ 需要 |
| **API稳定性** | ⭐⭐⭐ 一般 | ⭐⭐⭐⭐⭐ 很好 |
| **凭证有效期** | ~30天 | Token 2小时（可刷新） |
| **空间信息** | 可能被限流 | 稳定获取 |
| **适用场景** | 个人使用 | 生产环境 |

---

## 💡 最佳实践

1. **新手用户**：使用Cookie模式即可
2. **高级用户**：申请AppID后使用OpenAPI模式
3. **定期维护**：Cookie模式下每2周重新登录一次
4. **监控状态**：定期查看设置页面的账号状态
5. **不要频繁调用API**：建议间隔≥1秒

---

## 🆘 需要帮助？

如果遇到问题：

1. 查看本文档的"故障排查"部分
2. 查看 `docs/115_使用说明_重要.md`
3. 查看Docker日志：`docker logs tmc-local | tail -100`
4. 提供详细错误信息寻求帮助

---

**文档版本**：v2.0  
**更新日期**：2025-10-17  
**状态**：✅ 最新

---

## 🎉 总结

**现在的流程非常清晰**：

1. **扫码登录** = 获取Cookie（纯粹的Cookie模式）
2. **启用OPENAPI** = 使用Cookie+AppID获取Token（主动激活）

这种设计：
- ✅ 职责分离，逻辑清晰
- ✅ 用户有完整的控制权
- ✅ 容错性更好
- ✅ 适合各种使用场景

**请按照正确流程操作，祝您使用愉快！** 🎉

