# 115å¼€æ”¾å¹³å° OAuth 2.0 Device Code Flow å®ç°æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸå®ç°115å¼€æ”¾å¹³å°çš„å®Œæ•´OAuth 2.0è®¾å¤‡æˆæƒç æµç¨‹(Device Authorization Grant Flow with PKCE)ã€‚è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„OAuth 2.0æµç¨‹,é€‚ç”¨äºæ— æµè§ˆå™¨æˆ–è¾“å…¥å—é™çš„è®¾å¤‡ã€‚

---

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### åç«¯å®ç°

#### 1. **Pan115Client** (`app/backend/services/pan115_client.py`)

æ–°å¢/ä¿®æ”¹çš„æ ¸å¿ƒæ–¹æ³•:

- **`_generate_pkce_pair()`** 
  - ç”ŸæˆPKCE (Proof Key for Code Exchange) å‚æ•°
  - `code_verifier`: 43-128å­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²
  - `code_challenge`: code_verifierçš„SHA256å“ˆå¸Œå€¼(Base64 URLç¼–ç )
  - å¢å¼ºå®‰å…¨æ€§,é˜²æ­¢æˆæƒç è¢«æ‹¦æˆªæ”»å‡»

- **`get_device_code()`**
  - OAuth 2.0 Device Code Flow ç¬¬ä¸€æ­¥
  - å‘`https://passportapi.115.com/open/authDeviceCode`è¯·æ±‚è®¾å¤‡æˆæƒç 
  - è¿”å›: `device_code`, `user_code`, `verification_uri`, `expires_in`, `interval`, `code_verifier`

- **`poll_device_token(device_code, code_verifier, max_attempts, interval)`**
  - OAuth 2.0 Device Code Flow ç¬¬äºŒæ­¥
  - è½®è¯¢`https://passportapi.115.com/open/token`è·å–è®¿é—®ä»¤ç‰Œ
  - æ”¯æŒå¤šç§çŠ¶æ€å¤„ç†:
    - `authorization_pending`: ç”¨æˆ·å°šæœªæˆæƒ,ç»§ç»­ç­‰å¾…
    - `slow_down`: è½®è¯¢è¿‡äºé¢‘ç¹,å¢åŠ ç­‰å¾…æ—¶é—´
    - `expired_token`: è®¾å¤‡ç å·²è¿‡æœŸ
    - `access_denied`: ç”¨æˆ·æ‹’ç»æˆæƒ
  - æˆåŠŸåè¿”å›: `access_token`, `refresh_token`, `expires_in`

- **`get_access_token()`**
  - ç®€åŒ–è°ƒç”¨å…¥å£,ç›´æ¥è°ƒç”¨`get_device_code()`
  - è¿”å›è®¾å¤‡æˆæƒä¿¡æ¯ä¾›å‰ç«¯ä½¿ç”¨

#### 2. **APIè·¯ç”±** (`app/backend/api/routes/pan115.py`)

æ–°å¢/ä¿®æ”¹çš„ç«¯ç‚¹:

- **`POST /api/pan115/activate-open-api`**
  - ä¿®æ”¹ä¸ºè¿”å›è®¾å¤‡æˆæƒç ä¿¡æ¯(è€Œéç›´æ¥è·å–token)
  - å“åº”æ ¼å¼:
    ```json
    {
      "success": true,
      "step": "device_authorization",
      "device_code": "xxx",
      "user_code": "ABC-DEF",
      "verification_uri": "https://115.com/authorize",
      "expires_in": 600,
      "interval": 5,
      "code_verifier": "xxx",
      "message": "è¯·åœ¨æµè§ˆå™¨ä¸­è®¿é—®æˆæƒé¡µé¢..."
    }
    ```

- **`POST /api/pan115/poll-device-token`** (æ–°å¢)
  - è½®è¯¢è·å–è®¿é—®ä»¤ç‰Œ
  - è¯·æ±‚å‚æ•°: `device_code`, `code_verifier`
  - å“åº”æ ¼å¼:
    ```json
    {
      "success": true/false,
      "status": "pending|authorized|error|expired",
      "message": "..."
    }
    ```
  - æˆåŠŸæ—¶è‡ªåŠ¨ä¿å­˜`access_token`å’Œ`refresh_token`åˆ°æ•°æ®åº“
  - è‡ªåŠ¨åˆ·æ–°ç”¨æˆ·ä¿¡æ¯å’Œç©ºé—´æ•°æ®

### å‰ç«¯å®ç°

#### 1. **æœåŠ¡å±‚** (`app/frontend/src/services/pan115.ts`)

æ–°å¢APIæ–¹æ³•:

- **`activateOpenApi()`**
  - è°ƒç”¨åç«¯è·å–è®¾å¤‡æˆæƒç 
  - è¿”å›ç±»å‹åŒ…å«: `device_code`, `user_code`, `verification_uri`ç­‰

- **`pollDeviceToken(deviceCode, codeVerifier)`**
  - è½®è¯¢è·å–è®¿é—®ä»¤ç‰Œ
  - å‰ç«¯å®šæ—¶è°ƒç”¨,ç›´åˆ°æˆæƒå®Œæˆ

#### 2. **UIç»„ä»¶** (`app/frontend/src/pages/Settings/Pan115Settings.tsx`)

æ–°å¢çŠ¶æ€ç®¡ç†:

```typescript
// OAuth 2.0 Device Code FlowçŠ¶æ€
const [authModalVisible, setAuthModalVisible] = useState(false);
const [authUserCode, setAuthUserCode] = useState('');
const [authVerificationUri, setAuthVerificationUri] = useState('');
const [authDeviceCode, setAuthDeviceCode] = useState('');
const [authCodeVerifier, setAuthCodeVerifier] = useState('');
const [authPolling, setAuthPolling] = useState(false);
const [authStatus, setAuthStatus] = useState<'pending' | 'authorized' | 'error' | 'expired'>('pending');
```

æ–°å¢æ ¸å¿ƒåŠŸèƒ½:

- **OAuthæˆæƒå¼¹çª—**
  - æ˜¾ç¤ºå¤§å­—ä½“æˆæƒç (user_code)
  - æä¾›"æ‰“å¼€æˆæƒé¡µé¢"æŒ‰é’®
  - å®æ—¶æ˜¾ç¤ºæˆæƒçŠ¶æ€
  - è½®è¯¢è¿›åº¦æ˜¾ç¤º

- **è½®è¯¢æœºåˆ¶**
  - `startAuthPolling()`: å¼€å§‹å®šæ—¶è½®è¯¢
  - `stopAuthPolling()`: åœæ­¢è½®è¯¢
  - æœ€å¤§è½®è¯¢æ¬¡æ•°: 120æ¬¡ (5ç§’é—´éš” Ã— 120 = 10åˆ†é’Ÿ)
  - è‡ªåŠ¨å¤„ç†æˆæƒæˆåŠŸ/å¤±è´¥/è¶…æ—¶

---

## ğŸ”„ å®Œæ•´çš„æˆæƒæµç¨‹

### ç”¨æˆ·æ“ä½œæµç¨‹

1. **æ‰«ç ç™»å½•115è´¦å·** (æ­¥éª¤1)
   - é€‰æ‹©è®¾å¤‡ç±»å‹(qandroid/web/iosç­‰)
   - æ‰«ç è·å–cookies
   - ç³»ç»Ÿä¿å­˜cookiesåˆ°`/config/115-cookies.txt`

2. **å¡«å†™AppID** (æ­¥éª¤2)
   - åœ¨115è®¾ç½®é¡µé¢è¾“å…¥AppID
   - åœ¨[115å¼€æ”¾å¹³å°](https://www.yuque.com/115yun/open)ç”³è¯·

3. **å¯ç”¨å¼€æ”¾å¹³å°API** (æ­¥éª¤2)
   - ç‚¹å‡»"å¯ç”¨OPENAPI"å¼€å…³
   - ç³»ç»Ÿè‡ªåŠ¨è·å–è®¾å¤‡æˆæƒç 

4. **å®ŒæˆOAuthæˆæƒ** (å¼¹çª—å¼•å¯¼)
   - ç‚¹å‡»"æ‰“å¼€æˆæƒé¡µé¢"æŒ‰é’®
   - åœ¨æ–°æ‰“å¼€çš„é¡µé¢ä¸­è¾“å…¥æ˜¾ç¤ºçš„æˆæƒç 
   - å®Œæˆæˆæƒ
   - ç³»ç»Ÿè‡ªåŠ¨è·å–`access_token`
   - è‡ªåŠ¨åˆ·æ–°ç”¨æˆ·ä¿¡æ¯å’Œç©ºé—´æ•°æ®

### æŠ€æœ¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡»å¯ç”¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯: è°ƒç”¨ activateOpenApi()      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åç«¯: ç”Ÿæˆ PKCE å‚æ•°              â”‚
â”‚  - code_verifier (éšæœºå­—ç¬¦ä¸²)     â”‚
â”‚  - code_challenge (SHA256å“ˆå¸Œ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯·æ±‚è®¾å¤‡æˆæƒç                      â”‚
â”‚ POST /open/authDeviceCode         â”‚
â”‚ å‚æ•°: client_id, code_challenge   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 115æœåŠ¡å™¨è¿”å›:                     â”‚
â”‚  - device_code (è®¾å¤‡ç )           â”‚
â”‚  - user_code (ç”¨æˆ·æˆæƒç )         â”‚
â”‚  - verification_uri (æˆæƒURL)    â”‚
â”‚  - expires_in (æœ‰æ•ˆæœŸ)            â”‚
â”‚  - interval (è½®è¯¢é—´éš”)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯: æ˜¾ç¤ºæˆæƒå¼¹çª—                 â”‚
â”‚  - å±•ç¤º user_code                 â”‚
â”‚  - æä¾›æˆæƒURLé“¾æ¥                â”‚
â”‚  - å¼€å§‹å®šæ—¶è½®è¯¢                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚
       â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­:  â”‚         â”‚ å‰ç«¯å®šæ—¶è½®è¯¢:   â”‚
â”‚ 1. æ‰“å¼€æˆæƒé¡µé¢ â”‚         â”‚ pollDeviceToken â”‚
â”‚ 2. è¾“å…¥æˆæƒç    â”‚         â”‚ æ¯5ç§’è°ƒç”¨ä¸€æ¬¡   â”‚
â”‚ 3. ç¡®è®¤æˆæƒ     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ åç«¯æ£€æŸ¥çŠ¶æ€:   â”‚
                            â”‚ POST /open/tokenâ”‚
                            â”‚ å‚æ•°: device_code,â”‚
                            â”‚ code_verifier   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚                     â”‚
       â–¼                             â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pending     â”‚          â”‚ authorized       â”‚   â”‚ error/expired  â”‚
â”‚ ç»§ç»­ç­‰å¾…... â”‚          â”‚ è·å–åˆ°token!     â”‚   â”‚ æˆæƒå¤±è´¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ ä¿å­˜åˆ°æ•°æ®åº“:     â”‚
                       â”‚  - access_token  â”‚
                       â”‚  - refresh_token â”‚
                       â”‚  - expires_at    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ åˆ·æ–°ç”¨æˆ·ä¿¡æ¯:     â”‚
                       â”‚  - ç”¨æˆ·å        â”‚
                       â”‚  - VIPç­‰çº§       â”‚
                       â”‚  - ç©ºé—´ä¿¡æ¯      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### PKCE (Proof Key for Code Exchange)

- **ç›®çš„**: é˜²æ­¢æˆæƒç æ‹¦æˆªæ”»å‡»
- **å·¥ä½œåŸç†**:
  1. å®¢æˆ·ç«¯ç”Ÿæˆéšæœº`code_verifier`
  2. ä½¿ç”¨SHA256è®¡ç®—`code_challenge = BASE64URL(SHA256(code_verifier))`
  3. è¯·æ±‚è®¾å¤‡ç æ—¶å‘é€`code_challenge`
  4. è¯·æ±‚tokenæ—¶å‘é€`code_verifier`
  5. æœåŠ¡å™¨éªŒè¯`SHA256(code_verifier) == code_challenge`

### å…¶ä»–å®‰å…¨æªæ–½

- âœ… ä½¿ç”¨HTTPS (passportapi.115.com)
- âœ… Tokenå­˜å‚¨åœ¨åç«¯æ•°æ®åº“,å‰ç«¯ä¸æš´éœ²
- âœ… æ”¯æŒä»£ç†é…ç½®(å¯é€‰)
- âœ… è½®è¯¢è¶…æ—¶ä¿æŠ¤(æœ€å¤š10åˆ†é’Ÿ)
- âœ… æˆæƒç æœ‰æ•ˆæœŸé™åˆ¶

---

## ğŸ“Š çŠ¶æ€ç è¯´æ˜

| çŠ¶æ€ | æè¿° | å¤„ç†æ–¹å¼ |
|------|------|----------|
| `authorization_pending` | ç”¨æˆ·å°šæœªæˆæƒ | ç»§ç»­è½®è¯¢,ç­‰å¾…ç”¨æˆ·æ“ä½œ |
| `slow_down` | è½®è¯¢è¿‡äºé¢‘ç¹ | å¢åŠ ç­‰å¾…æ—¶é—´(interval Ã— 2) |
| `expired_token` | è®¾å¤‡ç å·²è¿‡æœŸ | åœæ­¢è½®è¯¢,æç¤ºç”¨æˆ·é‡æ–°æ¿€æ´» |
| `access_denied` | ç”¨æˆ·æ‹’ç»æˆæƒ | åœæ­¢è½®è¯¢,æç¤ºæˆæƒè¢«æ‹’ç» |
| `authorized` | æˆæƒæˆåŠŸ | åœæ­¢è½®è¯¢,ä¿å­˜token,åˆ·æ–°ç”¨æˆ·ä¿¡æ¯ |

---

## ğŸ¨ UI/UXç‰¹æ€§

### æˆæƒå¼¹çª—è®¾è®¡

1. **æ¸…æ™°çš„æ­¥éª¤è¯´æ˜**
   - ä¸‰æ­¥æ“ä½œæŒ‡å¼•
   - å›¾æ–‡å¹¶èŒ‚çš„è¯´æ˜

2. **çªå‡ºæ˜¾ç¤ºæˆæƒç **
   - å¤§å­—ä½“(32px)
   - è“è‰²é«˜äº®
   - ç­‰å®½å­—ä½“,å¢åŠ å­—é—´è·
   - ç°è‰²èƒŒæ™¯å¡ç‰‡

3. **å®æ—¶çŠ¶æ€åé¦ˆ**
   - è½®è¯¢è¿›åº¦æ˜¾ç¤º(å½“å‰æ¬¡æ•°/æ€»æ¬¡æ•°)
   - SpinåŠ è½½åŠ¨ç”»
   - çŠ¶æ€æ–‡æœ¬æç¤º

4. **å¤šçŠ¶æ€å±•ç¤º**
   - pending: ç­‰å¾…æˆæƒ(Spin + è¿›åº¦)
   - authorized: æˆæƒæˆåŠŸ(ç»¿è‰²å¯¹å‹¾ + æˆåŠŸæç¤º)
   - error: æˆæƒå¤±è´¥(çº¢è‰²è­¦å‘Š)
   - expired: è¶…æ—¶(é»„è‰²è­¦å‘Š + é‡æ–°æ¿€æ´»æŒ‰é’®)

---

## ğŸ› ï¸ é…ç½®è¯´æ˜

### åç«¯é…ç½®

æ— éœ€é¢å¤–é…ç½®,åªéœ€ç¡®ä¿ä»¥ä¸‹å­—æ®µå­˜åœ¨äºæ•°æ®åº“:

```python
# models.py - MediaSettings
pan115_app_id = Column(String, comment='115å¼€æ”¾å¹³å°AppID')
pan115_user_id = Column(String, comment='115ç”¨æˆ·ID')
pan115_user_key = Column(String, comment='115ç”¨æˆ·å‡­è¯(cookies)')
pan115_access_token = Column(String, comment='115å¼€æ”¾å¹³å°è®¿é—®ä»¤ç‰Œ')
pan115_refresh_token = Column(String, comment='115å¼€æ”¾å¹³å°åˆ·æ–°ä»¤ç‰Œ')
pan115_token_expires_at = Column(DateTime, comment='ä»¤ç‰Œè¿‡æœŸæ—¶é—´')
pan115_use_proxy = Column(Boolean, default=False, comment='æ˜¯å¦ä½¿ç”¨ä»£ç†')
```

### å‰ç«¯é…ç½®

æ— éœ€é…ç½®,å‰ç«¯ä¼šè‡ªåŠ¨é€‚é…åç«¯APIã€‚

---

## ğŸ“ APIæ–‡æ¡£

### 1. è·å–è®¾å¤‡æˆæƒç 

**ç«¯ç‚¹**: `POST /api/pan115/activate-open-api`

**è¯·æ±‚**: æ— éœ€bodyå‚æ•°,ä»æ•°æ®åº“è¯»å–AppIDå’Œcookies

**å“åº”**:
```json
{
  "success": true,
  "step": "device_authorization",
  "device_code": "d1e2f3g4h5i6j7k8",
  "user_code": "ABCD-EFGH",
  "verification_uri": "https://115.com/authorize",
  "expires_in": 600,
  "interval": 5,
  "code_verifier": "random_generated_string",
  "message": "è¯·åœ¨æµè§ˆå™¨ä¸­è®¿é—®æˆæƒé¡µé¢..."
}
```

### 2. è½®è¯¢è·å–è®¿é—®ä»¤ç‰Œ

**ç«¯ç‚¹**: `POST /api/pan115/poll-device-token`

**è¯·æ±‚**:
```json
{
  "device_code": "d1e2f3g4h5i6j7k8",
  "code_verifier": "random_generated_string"
}
```

**å“åº” - ç­‰å¾…ä¸­**:
```json
{
  "success": false,
  "status": "pending",
  "message": "ç­‰å¾…ç”¨æˆ·æˆæƒ..."
}
```

**å“åº” - æˆæƒæˆåŠŸ**:
```json
{
  "success": true,
  "status": "authorized",
  "message": "æˆæƒæˆåŠŸ,è®¿é—®ä»¤ç‰Œå·²è·å–"
}
```

**å“åº” - æˆæƒå¤±è´¥**:
```json
{
  "success": false,
  "status": "error",
  "message": "å…·ä½“é”™è¯¯ä¿¡æ¯"
}
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: è·å–è®¾å¤‡æˆæƒç å¤±è´¥

**å¯èƒ½åŸå› **:
- AppIDæœªé…ç½®
- Cookiesæœªé…ç½®æˆ–å·²è¿‡æœŸ
- ç½‘ç»œé—®é¢˜
- ä»£ç†é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥AppIDæ˜¯å¦æ­£ç¡®
2. é‡æ–°æ‰«ç ç™»å½•è·å–cookies
3. æµ‹è¯•ç½‘ç»œè¿æ¥
4. æ£€æŸ¥ä»£ç†è®¾ç½®(æ˜¯å¦éœ€è¦ä»£ç†)

### é—®é¢˜2: è½®è¯¢è¶…æ—¶

**å¯èƒ½åŸå› **:
- ç”¨æˆ·æœªåœ¨è§„å®šæ—¶é—´å†…å®Œæˆæˆæƒ
- æˆæƒé¡µé¢è®¿é—®å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ç”¨æˆ·å·²æ‰“å¼€æˆæƒé¡µé¢
2. ç¡®è®¤æˆæƒç è¾“å…¥æ­£ç¡®
3. æ£€æŸ¥115æœåŠ¡å™¨çŠ¶æ€
4. é‡æ–°æ¿€æ´»è·å–æ–°çš„æˆæƒç 

### é—®é¢˜3: æˆæƒæˆåŠŸä½†æœªè·å–ç©ºé—´ä¿¡æ¯

**å¯èƒ½åŸå› **:
- 115 APIé™æµ
- access_tokenæœ‰æ•ˆä½†æƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
1. ç­‰å¾…å‡ åˆ†é’Ÿåç‚¹å‡»"åˆ·æ–°ç”¨æˆ·ä¿¡æ¯"
2. æ£€æŸ¥åç«¯æ—¥å¿—æŸ¥çœ‹è¯¦ç»†é”™è¯¯
3. ç¡®è®¤AppIDæ‹¥æœ‰æ­£ç¡®çš„æƒé™èŒƒå›´

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [115å¼€æ”¾å¹³å°æ–‡æ¡£](https://www.yuque.com/115yun/open)
- [OAuth 2.0 Device Authorization Grant](https://datatracker.ietf.org/doc/html/rfc8628)
- [PKCE (RFC 7636)](https://datatracker.ietf.org/doc/html/rfc7636)

---

## ğŸ‰ æ€»ç»“

é€šè¿‡å®ç°å®Œæ•´çš„OAuth 2.0 Device Code Flow with PKCE,æˆ‘ä»¬:

âœ… æå‡äº†å®‰å…¨æ€§(PKCEé˜²æ­¢æˆæƒç æ‹¦æˆª)
âœ… æ”¹å–„äº†ç”¨æˆ·ä½“éªŒ(æ¸…æ™°çš„æˆæƒæµç¨‹å¼•å¯¼)
âœ… æé«˜äº†å¯é æ€§(æ ‡å‡†OAuthæµç¨‹,æ›´ç¨³å®š)
âœ… æ”¯æŒäº†çµæ´»é…ç½®(ä»£ç†å¯é€‰,è‡ªåŠ¨ä¿å­˜token)

**ä¸å†éœ€è¦AppSecret,åªéœ€è¦AppID + Cookieså³å¯å®Œæˆæ•´ä¸ªæˆæƒæµç¨‹!** ğŸš€

