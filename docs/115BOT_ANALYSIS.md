# 115Bot é¡¹ç›®æ·±åº¦åˆ†æä¸å€Ÿé‰´æ„ä¹‰

> é’ˆå¯¹ len996/115bot å’Œ qiqiandfei/Telegram-115bot çš„æ·±å…¥åˆ†æ
> 
> **åˆ†ææ—¥æœŸï¼š** 2025-01-12  
> **ç›®æ ‡ï¼š** ä¸ºTMCé¡¹ç›®çš„èµ„æºç›‘æ§æœåŠ¡æä¾›è®¾è®¡å‚è€ƒ

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆ](#1-é¡¹ç›®æ¦‚è§ˆ)
2. [æ ¸å¿ƒåŠŸèƒ½åˆ†æ](#2-æ ¸å¿ƒåŠŸèƒ½åˆ†æ)
3. [æŠ€æœ¯æ¶æ„è§£æ](#3-æŠ€æœ¯æ¶æ„è§£æ)
4. [å…³é”®å®ç°ç»†èŠ‚](#4-å…³é”®å®ç°ç»†èŠ‚)
5. [å¯¹TMCé¡¹ç›®çš„å€Ÿé‰´æ„ä¹‰](#5-å¯¹tmcé¡¹ç›®çš„å€Ÿé‰´æ„ä¹‰)
6. [åŠŸèƒ½å¯¹æ¯”ä¸å·®å¼‚](#6-åŠŸèƒ½å¯¹æ¯”ä¸å·®å¼‚)
7. [ä¼˜åŒ–å»ºè®®](#7-ä¼˜åŒ–å»ºè®®)

---

## 1. é¡¹ç›®æ¦‚è§ˆ

### 1.1 len996/115bot

**é¡¹ç›®å®šä½ï¼š** åŸºäºDockerçš„Telegramæœºå™¨äººï¼Œä¸“æ³¨äº115ç½‘ç›˜è‡ªåŠ¨åŒ–ç®¡ç†

**ä¸»è¦ç‰¹æ€§ï¼š**
- ğŸ”„ æ‰¹é‡è§£å‹ï¼šè‡ªåŠ¨è§£å‹115ç½‘ç›˜ä¸­çš„å‹ç¼©æ–‡ä»¶
- ğŸ“¹ è§†é¢‘è½¬å­˜ï¼šTelegramè§†é¢‘ç›´ä¼ 115ç½‘ç›˜
- ğŸ“º STRMæ–‡ä»¶ç”Ÿæˆï¼šåˆ›å»ºæµåª’ä½“æ’­æ”¾æ–‡ä»¶
- ğŸ“… è®¢é˜…ç®¡ç†ï¼šæ¯æ—¥è‡ªåŠ¨æ›´æ–°è®¢é˜…å†…å®¹
- ğŸŒ³ è®¸æ„¿æ ‘è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨è®¸æ„¿ã€åŠ©æ„¿ã€é‡‡çº³
- ğŸ“¥ ç¦»çº¿ä»»åŠ¡ç›‘æ§ï¼šç›‘æ§ä¸‹è½½è¿›åº¦ï¼Œè‡ªåŠ¨åå¤„ç†

**æŠ€æœ¯æ ˆï¼š**
- è¯­è¨€ï¼šJava
- éƒ¨ç½²ï¼šDockerå®¹å™¨åŒ–
- APIï¼šTelegram Bot API + 115ç½‘ç›˜API
- é…ç½®ï¼šapplication.properties

### 1.2 qiqiandfei/Telegram-115bot

**é¡¹ç›®å®šä½ï¼š** Pythonå®ç°çš„Telegramæœºå™¨äººï¼Œè½»é‡çº§115ç½‘ç›˜ç®¡ç†

**ä¸»è¦ç‰¹æ€§ï¼š**
- ğŸ“ æ–‡ä»¶ç®¡ç†ï¼šè¿œç¨‹æ§åˆ¶115ç½‘ç›˜æ–‡ä»¶æ“ä½œ
- â¬‡ï¸ ç¦»çº¿ä¸‹è½½ï¼šæ·»åŠ å’Œç®¡ç†ç¦»çº¿ä»»åŠ¡
- ğŸ¤– è‡ªåŠ¨åŒ–ï¼šæ–‡ä»¶é‡å‘½åã€åˆ†ç±»ç­‰

**æŠ€æœ¯æ ˆï¼š**
- è¯­è¨€ï¼šPython
- åº“ï¼špython-telegram-bot
- APIï¼š115ç½‘ç›˜API
- è®¾è®¡ï¼šæ¨¡å—åŒ–æ¶æ„

---

## 2. æ ¸å¿ƒåŠŸèƒ½åˆ†æ

### 2.1 ç¦»çº¿ä»»åŠ¡ç›‘æ§ï¼ˆé‡ç‚¹åŠŸèƒ½ï¼‰

**åŠŸèƒ½æè¿°ï¼š**
ç›‘æ§115ç½‘ç›˜çš„ç¦»çº¿ä¸‹è½½ä»»åŠ¡ï¼Œå®Œæˆåè‡ªåŠ¨æ‰§è¡Œåå¤„ç†æ“ä½œã€‚

**å®ç°é€»è¾‘ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¦»çº¿ä»»åŠ¡ç›‘æ§æµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ç”¨æˆ·æ·»åŠ ç¦»çº¿ä»»åŠ¡ï¼ˆç£åŠ›é“¾ã€ED2Kç­‰ï¼‰
   â†“
2. æœºå™¨äººè®°å½•ä»»åŠ¡IDå’Œå…ƒæ•°æ®
   â†“
3. å®šæ—¶è½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆæ¯30ç§’-5åˆ†é’Ÿï¼‰
   â”œâ”€ çŠ¶æ€ï¼šç­‰å¾…ä¸­ â†’ ç»§ç»­è½®è¯¢
   â”œâ”€ çŠ¶æ€ï¼šä¸‹è½½ä¸­ â†’ æ›´æ–°è¿›åº¦ï¼Œç»§ç»­è½®è¯¢
   â””â”€ çŠ¶æ€ï¼šå·²å®Œæˆ â†’ è§¦å‘åå¤„ç†
       â†“
4. è‡ªåŠ¨åå¤„ç†
   â”œâ”€ ç§»åŠ¨æ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•
   â”œâ”€ åˆ é™¤å¹¿å‘Šæ–‡ä»¶ï¼ˆæ ¹æ®è§„åˆ™ï¼‰
   â”œâ”€ é‡å‘½åæ–‡ä»¶ï¼ˆæ ¹æ®æ¨¡æ¿ï¼‰
   â”œâ”€ ç”ŸæˆSTRMæ–‡ä»¶ï¼ˆå¦‚æœæ˜¯è§†é¢‘ï¼‰
   â””â”€ å‘é€Telegramé€šçŸ¥
```

**å…³é”®æŠ€æœ¯ç‚¹ï¼š**

1. **è½®è¯¢ç­–ç•¥**
   - æ™ºèƒ½é—´éš”ï¼šæ ¹æ®ä»»åŠ¡çŠ¶æ€åŠ¨æ€è°ƒæ•´è½®è¯¢é¢‘ç‡
   - æŒ‡æ•°é€€é¿ï¼šå¤±è´¥æ—¶é€æ­¥å¢åŠ é—´éš”ï¼Œé¿å…APIé™æµ
   - æ‰¹é‡æŸ¥è¯¢ï¼šä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªä»»åŠ¡çŠ¶æ€ï¼Œå‡å°‘APIè°ƒç”¨

2. **çŠ¶æ€ç®¡ç†**
   ```java
   enum TaskStatus {
       PENDING,      // ç­‰å¾…ä¸­
       DOWNLOADING,  // ä¸‹è½½ä¸­
       COMPLETED,    // å·²å®Œæˆ
       FAILED,       // å¤±è´¥
       PROCESSING    // åå¤„ç†ä¸­
   }
   ```

3. **åå¤„ç†è§„åˆ™**
   - æ–‡ä»¶è¿‡æ»¤ï¼šæ ¹æ®æ‰©å±•åã€å¤§å°ã€æ–‡ä»¶åè¿‡æ»¤
   - ç›®å½•ç»„ç»‡ï¼šæŒ‰æ—¥æœŸã€ç±»å‹ã€æ¥æºåˆ†ç±»
   - æ™ºèƒ½é‡å‘½åï¼šæ”¯æŒå˜é‡æ›¿æ¢ï¼ˆ{title}ã€{date}ç­‰ï¼‰

### 2.2 è§†é¢‘è½¬å­˜

**åŠŸèƒ½æè¿°ï¼š**
å°†Telegramæ¶ˆæ¯ä¸­çš„è§†é¢‘æ–‡ä»¶ç›´æ¥ä¸Šä¼ åˆ°115ç½‘ç›˜ã€‚

**å®ç°æµç¨‹ï¼š**

```python
async def handle_video_message(message):
    # 1. ä¸‹è½½è§†é¢‘åˆ°ä¸´æ—¶ç›®å½•
    video = message.video
    temp_file = await download_telegram_file(video.file_id)
    
    # 2. æå–å…ƒæ•°æ®
    metadata = extract_video_metadata(temp_file)
    # - åˆ†è¾¨ç‡ã€æ—¶é•¿ã€ç¼–ç æ ¼å¼
    # - æ–‡ä»¶å¤§å°ã€MD5å“ˆå¸Œ
    
    # 3. ç”Ÿæˆç›®æ ‡è·¯å¾„
    target_path = generate_path_by_rule(metadata)
    # ä¾‹ï¼š/Telegramè§†é¢‘/2025/01/{sender}/{filename}
    
    # 4. ä¸Šä¼ åˆ°115ç½‘ç›˜
    result = await upload_to_115(temp_file, target_path)
    
    # 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    os.remove(temp_file)
    
    # 6. å‘é€æˆåŠŸé€šçŸ¥
    await send_notification(message.chat_id, result)
```

**ä¼˜åŒ–æŠ€æœ¯ï¼š**
- **ç§’ä¼ æ£€æµ‹**ï¼šä¸Šä¼ å‰è®¡ç®—SHA1ï¼Œæ£€æŸ¥115æ˜¯å¦å·²æœ‰ç›¸åŒæ–‡ä»¶
- **æ–­ç‚¹ç»­ä¼ **ï¼šå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œæ”¯æŒä¸­æ–­æ¢å¤
- **å¹¶å‘æ§åˆ¶**ï¼šé™åˆ¶åŒæ—¶ä¸Šä¼ æ•°é‡ï¼Œé¿å…å¸¦å®½å æ»¡

### 2.3 æ‰¹é‡è§£å‹

**åŠŸèƒ½æè¿°ï¼š**
è‡ªåŠ¨è§£å‹115ç½‘ç›˜ä¸­çš„å‹ç¼©æ–‡ä»¶ï¼ˆzipã€rarã€7zç­‰ï¼‰ã€‚

**å®ç°æ–¹å¼ï¼š**

```
æ–¹æ¡ˆAï¼šæœåŠ¡å™¨ç«¯è§£å‹ï¼ˆæ¨èï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç›‘å¬115ç½‘ç›˜æ–°å¢å‹ç¼©æ–‡ä»¶         â”‚
â”‚ 2. è°ƒç”¨115è§£å‹API                  â”‚
â”‚ 3. ç­‰å¾…è§£å‹å®Œæˆ                    â”‚
â”‚ 4. ç§»åŠ¨è§£å‹åæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•        â”‚
â”‚ 5. åˆ é™¤åŸå‹ç¼©åŒ…ï¼ˆå¯é€‰ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ¡ˆBï¼šæœ¬åœ°è§£å‹ï¼ˆå¤‡ç”¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä¸‹è½½å‹ç¼©æ–‡ä»¶åˆ°æœ¬åœ°              â”‚
â”‚ 2. ä½¿ç”¨unrar/7zè§£å‹                â”‚
â”‚ 3. ä¸Šä¼ è§£å‹åæ–‡ä»¶åˆ°115             â”‚
â”‚ 4. æ¸…ç†æœ¬åœ°ä¸´æ—¶æ–‡ä»¶                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯ç»†èŠ‚ï¼š**
- **å¯†ç ç®¡ç†**ï¼šæ”¯æŒé¢„è®¾å¯†ç åˆ—è¡¨ï¼Œè‡ªåŠ¨å°è¯•
- **åµŒå¥—è§£å‹**ï¼šé€’å½’è§£å‹å¤šå±‚å‹ç¼©åŒ…
- **æ–‡ä»¶è¿‡æ»¤**ï¼šè§£å‹æ—¶è¿‡æ»¤å¹¿å‘Šæ–‡ä»¶ã€æ ·æœ¬æ–‡ä»¶

### 2.4 STRMæ–‡ä»¶ç”Ÿæˆ

**åŠŸèƒ½æè¿°ï¼š**
ä¸ºè§†é¢‘æ–‡ä»¶ç”ŸæˆSTRMæµåª’ä½“æ–‡ä»¶ï¼Œä¾›Emby/Jellyfin/Plexæ’­æ”¾ã€‚

**STRMæ–‡ä»¶æ ¼å¼ï¼š**
```
# video.strm
https://webapi.115.com/files/video/play?pickcode=xxxxx&app_ver=25.2.0
```

**ç”Ÿæˆé€»è¾‘ï¼š**
```python
def generate_strm_file(video_path, pickcode):
    """ç”ŸæˆSTRMæ–‡ä»¶"""
    # 1. æ„å»ºæ’­æ”¾é“¾æ¥
    play_url = f"https://webapi.115.com/files/video/play?pickcode={pickcode}"
    
    # 2. ç”ŸæˆSTRMæ–‡ä»¶è·¯å¾„
    strm_path = video_path.replace(video_ext, '.strm')
    
    # 3. å†™å…¥STRMæ–‡ä»¶
    with open(strm_path, 'w') as f:
        f.write(play_url)
    
    # 4. ä¸Šä¼ åˆ°115ç½‘ç›˜ï¼ˆä¸è§†é¢‘åŒç›®å½•ï¼‰
    upload_to_115(strm_path, target_dir)
```

**åº”ç”¨åœºæ™¯ï¼š**
- å®¶åº­åª’ä½“æœåŠ¡å™¨ï¼šEmby/Jellyfinç›´æ¥æ’­æ”¾115ç½‘ç›˜è§†é¢‘
- èŠ‚çœæœ¬åœ°å­˜å‚¨ï¼šæ— éœ€ä¸‹è½½è§†é¢‘åˆ°æœ¬åœ°
- ç»Ÿä¸€ç®¡ç†ï¼šè§†é¢‘å’ŒSTRMæ–‡ä»¶åœ¨åŒä¸€ç›®å½•

---

## 3. æŠ€æœ¯æ¶æ„è§£æ

### 3.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚                               â”‚
â”‚                    (Telegramå®¢æˆ·ç«¯)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Telegram Bot API                        â”‚
â”‚                   (æ¶ˆæ¯æ¥æ”¶/å‘é€æ¥å£)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      115Botæ ¸å¿ƒæœåŠ¡                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ¶ˆæ¯å¤„ç†å™¨   â”‚  â”‚ ä»»åŠ¡è°ƒåº¦å™¨   â”‚  â”‚ æ–‡ä»¶ç®¡ç†å™¨   â”‚      â”‚
â”‚  â”‚ - å‘½ä»¤è§£æ   â”‚  â”‚ - å®šæ—¶ä»»åŠ¡   â”‚  â”‚ - ä¸Šä¼ ä¸‹è½½   â”‚      â”‚
â”‚  â”‚ - äº‹ä»¶åˆ†å‘   â”‚  â”‚ - çŠ¶æ€è½®è¯¢   â”‚  â”‚ - æ–‡ä»¶ç»„ç»‡   â”‚      â”‚
â”‚  â”‚ - æƒé™éªŒè¯   â”‚  â”‚ - é‡è¯•æœºåˆ¶   â”‚  â”‚ - å…ƒæ•°æ®æå– â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è§„åˆ™å¼•æ“     â”‚  â”‚ é€šçŸ¥æœåŠ¡     â”‚  â”‚ ç¼“å­˜å±‚       â”‚      â”‚
â”‚  â”‚ - è¿‡æ»¤è§„åˆ™   â”‚  â”‚ - æ¶ˆæ¯æ¨é€   â”‚  â”‚ - Redis      â”‚      â”‚
â”‚  â”‚ - é‡å‘½åæ¨¡æ¿ â”‚  â”‚ - è¿›åº¦æ›´æ–°   â”‚  â”‚ - æœ¬åœ°ç¼“å­˜   â”‚      â”‚
â”‚  â”‚ - è‡ªåŠ¨åŒ–è„šæœ¬ â”‚  â”‚ - é”™è¯¯æŠ¥å‘Š   â”‚  â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      115ç½‘ç›˜API                              â”‚
â”‚  - æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½  - ç¦»çº¿ä»»åŠ¡ç®¡ç†  - æ–‡ä»¶æ“ä½œ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      115ç½‘ç›˜å­˜å‚¨                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒæ¨¡å—

#### 3.2.1 æ¶ˆæ¯å¤„ç†å™¨ï¼ˆMessage Handlerï¼‰

**èŒè´£ï¼š**
- æ¥æ”¶Telegramæ¶ˆæ¯
- è§£æå‘½ä»¤å’Œå‚æ•°
- åˆ†å‘åˆ°å¯¹åº”å¤„ç†å™¨

**å®ç°ç¤ºä¾‹ï¼š**
```java
@Component
public class MessageHandler {
    
    @Autowired
    private CommandRegistry commandRegistry;
    
    public void handleMessage(Update update) {
        Message message = update.getMessage();
        
        // 1. æƒé™éªŒè¯
        if (!isAuthorized(message.getFrom())) {
            sendUnauthorizedMessage(message.getChatId());
            return;
        }
        
        // 2. è§£æå‘½ä»¤
        String text = message.getText();
        if (text.startsWith("/")) {
            Command command = parseCommand(text);
            commandRegistry.execute(command, message);
        }
        
        // 3. å¤„ç†åª’ä½“æ–‡ä»¶
        else if (message.hasVideo()) {
            handleVideoMessage(message);
        }
        else if (message.hasDocument()) {
            handleDocumentMessage(message);
        }
    }
}
```

#### 3.2.2 ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰

**èŒè´£ï¼š**
- ç®¡ç†å®šæ—¶ä»»åŠ¡
- è½®è¯¢ç¦»çº¿ä»»åŠ¡çŠ¶æ€
- æ‰§è¡Œè‡ªåŠ¨åŒ–è„šæœ¬

**å®ç°ç¤ºä¾‹ï¼š**
```java
@Component
public class TaskScheduler {
    
    private final ScheduledExecutorService executor = 
        Executors.newScheduledThreadPool(5);
    
    // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ç¦»çº¿ä»»åŠ¡
    @Scheduled(fixedRate = 300000)
    public void checkOfflineTasks() {
        List<OfflineTask> tasks = taskRepository.findPendingTasks();
        
        for (OfflineTask task : tasks) {
            // æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
            TaskStatus status = pan115Client.getTaskStatus(task.getId());
            
            // æ›´æ–°æ•°æ®åº“
            task.setStatus(status);
            taskRepository.save(task);
            
            // å¦‚æœå®Œæˆï¼Œè§¦å‘åå¤„ç†
            if (status == TaskStatus.COMPLETED) {
                postProcessTask(task);
            }
        }
    }
}
```

#### 3.2.3 æ–‡ä»¶ç®¡ç†å™¨ï¼ˆFile Managerï¼‰

**èŒè´£ï¼š**
- æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- æ–‡ä»¶ç»„ç»‡å’Œé‡å‘½å
- å…ƒæ•°æ®æå–

**å®ç°ç¤ºä¾‹ï¼š**
```python
class FileManager:
    """æ–‡ä»¶ç®¡ç†å™¨"""
    
    def __init__(self, pan115_client):
        self.client = pan115_client
        self.temp_dir = "/tmp/115bot"
    
    async def upload_file(self, local_path, remote_path, metadata=None):
        """ä¸Šä¼ æ–‡ä»¶åˆ°115ç½‘ç›˜"""
        # 1. æ£€æŸ¥ç§’ä¼ 
        file_hash = self.calculate_sha1(local_path)
        if self.client.check_quick_upload(file_hash):
            logger.info("ç§’ä¼ æˆåŠŸ")
            return
        
        # 2. åˆ†ç‰‡ä¸Šä¼ 
        file_size = os.path.getsize(local_path)
        chunk_size = 10 * 1024 * 1024  # 10MB
        
        with open(local_path, 'rb') as f:
            for i, chunk in enumerate(self.read_chunks(f, chunk_size)):
                await self.client.upload_chunk(
                    chunk, 
                    chunk_index=i,
                    total_chunks=math.ceil(file_size / chunk_size)
                )
        
        # 3. å®Œæˆä¸Šä¼ 
        await self.client.complete_upload(remote_path, metadata)
```

### 3.3 æ•°æ®æ¨¡å‹

#### 3.3.1 ç¦»çº¿ä»»åŠ¡è¡¨

```sql
CREATE TABLE offline_tasks (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id VARCHAR(100) UNIQUE NOT NULL,  -- 115ä»»åŠ¡ID
    url TEXT NOT NULL,                      -- ç£åŠ›é“¾/ED2K
    name VARCHAR(500),                      -- ä»»åŠ¡åç§°
    status VARCHAR(20) DEFAULT 'pending',   -- çŠ¶æ€
    progress INT DEFAULT 0,                 -- è¿›åº¦(0-100)
    file_size BIGINT,                       -- æ–‡ä»¶å¤§å°
    download_speed BIGINT,                  -- ä¸‹è½½é€Ÿåº¦
    target_dir VARCHAR(500),                -- ç›®æ ‡ç›®å½•
    post_process_rules TEXT,                -- åå¤„ç†è§„åˆ™(JSON)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);
```

#### 3.3.2 æ–‡ä»¶è®°å½•è¡¨

```sql
CREATE TABLE file_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    pickcode VARCHAR(100) UNIQUE NOT NULL,  -- 115æ–‡ä»¶ID
    file_name VARCHAR(500) NOT NULL,
    file_path VARCHAR(1000),                -- 115ç½‘ç›˜è·¯å¾„
    file_size BIGINT,
    file_hash VARCHAR(64),                  -- SHA1å“ˆå¸Œ
    file_type VARCHAR(50),                  -- æ–‡ä»¶ç±»å‹
    metadata TEXT,                          -- å…ƒæ•°æ®(JSON)
    source VARCHAR(50),                     -- æ¥æº(telegram/offline)
    source_id VARCHAR(100),                 -- æ¥æºID
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_pickcode (pickcode),
    INDEX idx_file_hash (file_hash),
    INDEX idx_source (source, source_id)
);
```

---

## 4. å…³é”®å®ç°ç»†èŠ‚

### 4.1 APIé™æµå¤„ç†

**é—®é¢˜ï¼š**
115ç½‘ç›˜APIæœ‰ä¸¥æ ¼çš„é™æµç­–ç•¥ï¼Œé¢‘ç¹è°ƒç”¨ä¼šå¯¼è‡´å°ç¦ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

```python
class RateLimiter:
    """APIé™æµå™¨"""
    
    def __init__(self, max_requests=30, time_window=60):
        self.max_requests = max_requests  # 60ç§’å†…æœ€å¤š30æ¬¡
        self.time_window = time_window
        self.requests = []
        self.lock = asyncio.Lock()
    
    async def acquire(self):
        """è·å–è¯·æ±‚è®¸å¯"""
        async with self.lock:
            now = time.time()
            
            # æ¸…ç†è¿‡æœŸè®°å½•
            self.requests = [t for t in self.requests if now - t < self.time_window]
            
            # æ£€æŸ¥æ˜¯å¦è¶…é™
            if len(self.requests) >= self.max_requests:
                # è®¡ç®—éœ€è¦ç­‰å¾…çš„æ—¶é—´
                oldest = self.requests[0]
                wait_time = self.time_window - (now - oldest)
                logger.warning(f"APIé™æµï¼Œç­‰å¾…{wait_time:.1f}ç§’")
                await asyncio.sleep(wait_time)
            
            # è®°å½•æœ¬æ¬¡è¯·æ±‚
            self.requests.append(now)

# ä½¿ç”¨ç¤ºä¾‹
rate_limiter = RateLimiter(max_requests=30, time_window=60)

async def call_115_api(endpoint, params):
    await rate_limiter.acquire()
    return await api_client.request(endpoint, params)
```

### 4.2 æ™ºèƒ½é‡è¯•æœºåˆ¶

**ç­–ç•¥ï¼š**
- æŒ‡æ•°é€€é¿ï¼šæ¯æ¬¡é‡è¯•é—´éš”ç¿»å€ï¼ˆ1s â†’ 2s â†’ 4s â†’ 8sï¼‰
- æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š3-5æ¬¡
- é”™è¯¯åˆ†ç±»ï¼šåŒºåˆ†ä¸´æ—¶é”™è¯¯å’Œæ°¸ä¹…é”™è¯¯

**å®ç°ï¼š**

```python
async def retry_with_backoff(func, max_retries=5, base_delay=1):
    """å¸¦æŒ‡æ•°é€€é¿çš„é‡è¯•"""
    for attempt in range(max_retries):
        try:
            return await func()
        except TemporaryError as e:
            if attempt == max_retries - 1:
                raise
            
            delay = base_delay * (2 ** attempt)
            logger.warning(f"é‡è¯• {attempt+1}/{max_retries}ï¼Œç­‰å¾…{delay}ç§’: {e}")
            await asyncio.sleep(delay)
        except PermanentError as e:
            logger.error(f"æ°¸ä¹…é”™è¯¯ï¼Œåœæ­¢é‡è¯•: {e}")
            raise
```

### 4.3 æ–‡ä»¶å»é‡

**æ–¹æ³•ï¼š**
1. **å“ˆå¸Œå»é‡**ï¼šè®¡ç®—æ–‡ä»¶SHA1ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
2. **ç§’ä¼ æ£€æµ‹**ï¼šä¸Šä¼ å‰æ£€æŸ¥115æ˜¯å¦å·²æœ‰ç›¸åŒæ–‡ä»¶
3. **æ•°æ®åº“è®°å½•**ï¼šç»´æŠ¤æ–‡ä»¶å“ˆå¸Œç´¢å¼•

**å®ç°ï¼š**

```python
async def upload_with_dedup(file_path, target_dir):
    """å¸¦å»é‡çš„ä¸Šä¼ """
    # 1. è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
    file_hash = calculate_sha1(file_path)
    
    # 2. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²å­˜åœ¨
    existing = await db.query(FileRecord).filter_by(file_hash=file_hash).first()
    if existing:
        logger.info(f"æ–‡ä»¶å·²å­˜åœ¨: {existing.file_path}")
        return existing
    
    # 3. æ£€æŸ¥115ç§’ä¼ 
    quick_result = await pan115_client.check_quick_upload(file_hash)
    if quick_result['exists']:
        logger.info("ç§’ä¼ æˆåŠŸ")
        # è®°å½•åˆ°æ•°æ®åº“
        record = FileRecord(
            pickcode=quick_result['pickcode'],
            file_hash=file_hash,
            file_path=target_dir + '/' + os.path.basename(file_path)
        )
        await db.add(record)
        return record
    
    # 4. æ­£å¸¸ä¸Šä¼ 
    result = await pan115_client.upload_file(file_path, target_dir)
    
    # 5. è®°å½•åˆ°æ•°æ®åº“
    record = FileRecord(
        pickcode=result['pickcode'],
        file_hash=file_hash,
        file_path=result['file_path']
    )
    await db.add(record)
    return record
```

### 4.4 å¹¶å‘æ§åˆ¶

**é—®é¢˜ï¼š**
- åŒæ—¶ä¸Šä¼ å¤šä¸ªå¤§æ–‡ä»¶ä¼šå æ»¡å¸¦å®½
- å¹¶å‘è¿‡é«˜ä¼šè§¦å‘APIé™æµ

**è§£å†³æ–¹æ¡ˆï¼š**

```python
class ConcurrencyLimiter:
    """å¹¶å‘é™åˆ¶å™¨"""
    
    def __init__(self, max_concurrent=3):
        self.semaphore = asyncio.Semaphore(max_concurrent)
    
    async def run(self, coro):
        """åœ¨å¹¶å‘é™åˆ¶ä¸‹è¿è¡Œåç¨‹"""
        async with self.semaphore:
            return await coro

# ä½¿ç”¨ç¤ºä¾‹
limiter = ConcurrencyLimiter(max_concurrent=3)

async def upload_multiple_files(files):
    """å¹¶å‘ä¸Šä¼ å¤šä¸ªæ–‡ä»¶"""
    tasks = [
        limiter.run(upload_file(f))
        for f in files
    ]
    return await asyncio.gather(*tasks)
```

---

## 5. å¯¹TMCé¡¹ç›®çš„å€Ÿé‰´æ„ä¹‰

### 5.1 åŠŸèƒ½å±‚é¢

#### 5.1.1 ç¦»çº¿ä»»åŠ¡ç›‘æ§ â†’ èµ„æºç›‘æ§æœåŠ¡

**115Botçš„å®ç°ï¼š**
- è½®è¯¢115ç¦»çº¿ä»»åŠ¡çŠ¶æ€
- å®Œæˆåè‡ªåŠ¨åå¤„ç†
- æ”¯æŒæ‰¹é‡ç®¡ç†

**TMCå¯å€Ÿé‰´ï¼š**

```python
# åœ¨ app/backend/services/resource_monitor_service.py ä¸­æ–°å¢

class ResourceMonitorService:
    """èµ„æºç›‘æ§æœåŠ¡ - å€Ÿé‰´115Botçš„ç¦»çº¿ä»»åŠ¡ç›‘æ§"""
    
    async def monitor_telegram_resources(self, message):
        """ç›‘æ§Telegramæ¶ˆæ¯ä¸­çš„èµ„æºé“¾æ¥"""
        # 1. æå–èµ„æºé“¾æ¥ï¼ˆç£åŠ›é“¾ã€ED2Kã€ç½‘ç›˜é“¾æ¥ç­‰ï¼‰
        links = self.extract_resource_links(message.text)
        
        # 2. åˆ›å»ºç›‘æ§ä»»åŠ¡
        for link in links:
            task = ResourceMonitorTask(
                link=link,
                source_chat=message.chat_id,
                source_message=message.id,
                status='pending'
            )
            await self.db.add(task)
        
        # 3. å®šæ—¶è½®è¯¢èµ„æºçŠ¶æ€
        asyncio.create_task(self.poll_resource_status(task))
    
    async def poll_resource_status(self, task):
        """è½®è¯¢èµ„æºçŠ¶æ€ï¼ˆç±»ä¼¼115Botçš„ç¦»çº¿ä»»åŠ¡è½®è¯¢ï¼‰"""
        while task.status not in ['completed', 'failed']:
            # æ£€æŸ¥èµ„æºæ˜¯å¦å¯ç”¨
            status = await self.check_resource_availability(task.link)
            
            if status == 'available':
                # è§¦å‘ä¸‹è½½
                await self.trigger_download(task)
                task.status = 'completed'
            elif status == 'failed':
                task.status = 'failed'
            else:
                # ç­‰å¾…åé‡è¯•
                await asyncio.sleep(300)  # 5åˆ†é’Ÿ
```

**ä¼˜åŠ¿ï¼š**
- âœ… è‡ªåŠ¨åŒ–ï¼šæ— éœ€æ‰‹åŠ¨æ£€æŸ¥èµ„æºçŠ¶æ€
- âœ… å¯é æ€§ï¼šæ”¯æŒé‡è¯•å’Œé”™è¯¯æ¢å¤
- âœ… å¯æ‰©å±•ï¼šæ˜“äºæ·»åŠ æ–°çš„èµ„æºç±»å‹

#### 5.1.2 æ™ºèƒ½æ–‡ä»¶ç»„ç»‡ â†’ åª’ä½“æ–‡ä»¶å½’æ¡£

**115Botçš„å®ç°ï¼š**
- æŒ‰æ—¥æœŸ/ç±»å‹/æ¥æºåˆ†ç±»
- æ”¯æŒè‡ªå®šä¹‰å‘½åæ¨¡æ¿
- è‡ªåŠ¨åˆ é™¤å¹¿å‘Šæ–‡ä»¶

**TMCå¯å€Ÿé‰´ï¼š**

```python
# å¢å¼º app/backend/services/media_monitor_service.py ä¸­çš„ FileOrganizer

class EnhancedFileOrganizer(FileOrganizer):
    """å¢å¼ºçš„æ–‡ä»¶ç»„ç»‡å™¨ - å€Ÿé‰´115Bot"""
    
    @staticmethod
    def apply_smart_filters(file_path: str, metadata: Dict) -> bool:
        """æ™ºèƒ½è¿‡æ»¤ï¼ˆå€Ÿé‰´115Botçš„å¹¿å‘Šæ–‡ä»¶è¿‡æ»¤ï¼‰"""
        filename = Path(file_path).name.lower()
        
        # 1. å¹¿å‘Šæ–‡ä»¶ç‰¹å¾
        ad_patterns = [
            r'www\.',           # ç½‘å€
            r'\.url$',          # URLæ–‡ä»¶
            r'å¹¿å‘Š',            # å¹¿å‘Šå…³é”®è¯
            r'sample',          # æ ·æœ¬æ–‡ä»¶
            r'\.nfo$',          # NFOæ–‡ä»¶
        ]
        
        for pattern in ad_patterns:
            if re.search(pattern, filename):
                logger.info(f"è¿‡æ»¤å¹¿å‘Šæ–‡ä»¶: {filename}")
                return False
        
        # 2. æ–‡ä»¶å¤§å°è¿‡æ»¤ï¼ˆå°äº1MBçš„è§†é¢‘å¯èƒ½æ˜¯æ ·æœ¬ï¼‰
        if metadata.get('type') == 'video':
            size_mb = metadata.get('file_size_mb', 0)
            if size_mb < 1:
                logger.info(f"è¿‡æ»¤å°æ–‡ä»¶: {filename} ({size_mb}MB)")
                return False
        
        return True
    
    @staticmethod
    def generate_smart_filename(rule, original_name, metadata):
        """æ™ºèƒ½é‡å‘½åï¼ˆå€Ÿé‰´115Botçš„å‘½åæ¨¡æ¿ï¼‰"""
        # 1. æå–è§†é¢‘ä¿¡æ¯ï¼ˆå¦‚æœæ˜¯è§†é¢‘ï¼‰
        if metadata.get('type') == 'video':
            # ä»æ–‡ä»¶åæå–ä¿¡æ¯ï¼šåˆ†è¾¨ç‡ã€ç¼–ç ç­‰
            info = VideoInfoExtractor.extract(original_name)
            metadata.update(info)
        
        # 2. åº”ç”¨å‘½åæ¨¡æ¿
        template = rule.filename_template or '{date}_{original_name}'
        
        # 3. æ”¯æŒæ›´å¤šå˜é‡
        replacements = {
            '{date}': datetime.now().strftime('%Y%m%d'),
            '{time}': datetime.now().strftime('%H%M%S'),
            '{resolution}': metadata.get('resolution', ''),
            '{codec}': metadata.get('codec', ''),
            '{quality}': metadata.get('quality', ''),  # æ–°å¢ï¼šç”»è´¨ï¼ˆ1080pã€4Kç­‰ï¼‰
            '{source}': metadata.get('source', ''),    # æ–°å¢ï¼šæ¥æºï¼ˆWEB-DLã€BluRayç­‰ï¼‰
            '{original_name}': Path(original_name).stem
        }
        
        filename = template
        for key, value in replacements.items():
            filename = filename.replace(key, str(value))
        
        return filename + Path(original_name).suffix
```

**ä¼˜åŠ¿ï¼š**
- âœ… æ™ºèƒ½è¿‡æ»¤ï¼šè‡ªåŠ¨åˆ é™¤æ— ç”¨æ–‡ä»¶
- âœ… çµæ´»å‘½åï¼šæ”¯æŒä¸°å¯Œçš„å˜é‡
- âœ… ä¿¡æ¯æå–ï¼šä»æ–‡ä»¶åæå–å…ƒæ•°æ®

#### 5.1.3 æ‰¹é‡æ“ä½œ â†’ æ‰¹é‡ä¸‹è½½ç®¡ç†

**115Botçš„å®ç°ï¼š**
- æ‰¹é‡æ·»åŠ ç¦»çº¿ä»»åŠ¡
- æ‰¹é‡è§£å‹æ–‡ä»¶
- æ‰¹é‡ç”ŸæˆSTRM

**TMCå¯å€Ÿé‰´ï¼š**

```python
# åœ¨ app/backend/api/routes/media_monitor.py ä¸­æ–°å¢

@router.post("/batch-operations")
async def batch_operations(
    operation: str,  # download/organize/upload
    task_ids: List[int],
    db: AsyncSession = Depends(get_db)
):
    """æ‰¹é‡æ“ä½œï¼ˆå€Ÿé‰´115Botï¼‰"""
    
    if operation == 'download':
        # æ‰¹é‡é‡æ–°ä¸‹è½½
        for task_id in task_ids:
            task = await db.get(DownloadTask, task_id)
            if task:
                task.status = 'pending'
                task.retry_count = 0
        await db.commit()
        return {"success": True, "message": f"å·²é‡æ–°å¯åŠ¨{len(task_ids)}ä¸ªä¸‹è½½ä»»åŠ¡"}
    
    elif operation == 'organize':
        # æ‰¹é‡é‡æ–°å½’æ¡£
        for task_id in task_ids:
            media_file = await db.query(MediaFile).filter_by(download_task_id=task_id).first()
            if media_file and media_file.temp_path:
                # é‡æ–°å½’æ¡£
                await FileOrganizer.organize_file(rule, media_file.temp_path, metadata)
        await db.commit()
        return {"success": True, "message": f"å·²é‡æ–°å½’æ¡£{len(task_ids)}ä¸ªæ–‡ä»¶"}
    
    elif operation == 'upload':
        # æ‰¹é‡ä¸Šä¼ åˆ°115
        for task_id in task_ids:
            media_file = await db.query(MediaFile).filter_by(download_task_id=task_id).first()
            if media_file and (media_file.temp_path or media_file.final_path):
                # ä¸Šä¼ åˆ°115
                source_file = media_file.final_path or media_file.temp_path
                await p115_service.upload_file(cookies, source_file, target_dir)
        await db.commit()
        return {"success": True, "message": f"å·²ä¸Šä¼ {len(task_ids)}ä¸ªæ–‡ä»¶åˆ°115ç½‘ç›˜"}
```

### 5.2 æ¶æ„å±‚é¢

#### 5.2.1 ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

**115Botçš„è®¾è®¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç¦»çº¿ä»»åŠ¡è½®è¯¢ (æ¯5åˆ†é’Ÿ)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ–‡ä»¶æ¸…ç†ä»»åŠ¡ (æ¯å¤©å‡Œæ™¨2ç‚¹)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è®¢é˜…æ›´æ–°æ£€æŸ¥ (æ¯å¤©æ—©ä¸Š8ç‚¹)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**TMCå¯å€Ÿé‰´ï¼š**

```python
# åˆ›å»º app/backend/services/task_scheduler.py

from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.triggers.cron import CronTrigger
from apscheduler.triggers.interval import IntervalTrigger

class TaskScheduler:
    """ä»»åŠ¡è°ƒåº¦å™¨ - å€Ÿé‰´115Bot"""
    
    def __init__(self):
        self.scheduler = AsyncIOScheduler()
    
    def start(self):
        """å¯åŠ¨è°ƒåº¦å™¨"""
        # 1. æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸‹è½½ä»»åŠ¡çŠ¶æ€
        self.scheduler.add_job(
            self.check_download_tasks,
            trigger=IntervalTrigger(minutes=5),
            id='check_download_tasks',
            name='æ£€æŸ¥ä¸‹è½½ä»»åŠ¡çŠ¶æ€'
        )
        
        # 2. æ¯å¤©å‡Œæ™¨2ç‚¹æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        self.scheduler.add_job(
            self.cleanup_temp_files,
            trigger=CronTrigger(hour=2, minute=0),
            id='cleanup_temp_files',
            name='æ¸…ç†ä¸´æ—¶æ–‡ä»¶'
        )
        
        # 3. æ¯å°æ—¶æ£€æŸ¥å­˜å‚¨ç©ºé—´
        self.scheduler.add_job(
            self.check_storage_space,
            trigger=IntervalTrigger(hours=1),
            id='check_storage_space',
            name='æ£€æŸ¥å­˜å‚¨ç©ºé—´'
        )
        
        # 4. æ¯å¤©æ—©ä¸Š8ç‚¹ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š
        self.scheduler.add_job(
            self.generate_daily_report,
            trigger=CronTrigger(hour=8, minute=0),
            id='generate_daily_report',
            name='ç”Ÿæˆæ¯æ—¥æŠ¥å‘Š'
        )
        
        self.scheduler.start()
        logger.info("ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨")
    
    async def check_download_tasks(self):
        """æ£€æŸ¥ä¸‹è½½ä»»åŠ¡çŠ¶æ€ï¼ˆç±»ä¼¼115Botçš„ç¦»çº¿ä»»åŠ¡è½®è¯¢ï¼‰"""
        async for db in get_db():
            # æŸ¥æ‰¾é•¿æ—¶é—´æœªå®Œæˆçš„ä»»åŠ¡
            stale_tasks = await db.execute(
                select(DownloadTask).where(
                    DownloadTask.status == 'downloading',
                    DownloadTask.started_at < datetime.now() - timedelta(hours=2)
                )
            )
            
            for task in stale_tasks.scalars():
                logger.warning(f"å‘ç°å¡ä½çš„ä»»åŠ¡: {task.file_name}")
                # é‡ç½®çŠ¶æ€ï¼Œé‡æ–°ä¸‹è½½
                task.status = 'pending'
                task.retry_count += 1
            
            await db.commit()
            break
    
    async def cleanup_temp_files(self):
        """æ¸…ç†ä¸´æ—¶æ–‡ä»¶"""
        async for db in get_db():
            settings = await db.execute(select(MediaSettings))
            settings = settings.scalar_one_or_none()
            
            if not settings or not settings.auto_cleanup_enabled:
                return
            
            # æŸ¥æ‰¾è¿‡æœŸçš„ä¸´æ—¶æ–‡ä»¶
            cutoff_date = datetime.now() - timedelta(days=settings.auto_cleanup_days)
            
            old_files = await db.execute(
                select(MediaFile).where(
                    MediaFile.temp_path.isnot(None),
                    MediaFile.downloaded_at < cutoff_date
                )
            )
            
            for media_file in old_files.scalars():
                # åªæ¸…ç†å·²å½’æ¡£çš„æ–‡ä»¶
                if settings.cleanup_only_organized and not media_file.is_organized:
                    continue
                
                # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
                if os.path.exists(media_file.temp_path):
                    os.remove(media_file.temp_path)
                    logger.info(f"æ¸…ç†ä¸´æ—¶æ–‡ä»¶: {media_file.temp_path}")
                
                media_file.temp_path = None
            
            await db.commit()
            break
```

#### 5.2.2 æ¶ˆæ¯é˜Ÿåˆ—

**115Botçš„è®¾è®¡ï¼š**
- ä½¿ç”¨å†…å­˜é˜Ÿåˆ—å¤„ç†æ¶ˆæ¯
- æ”¯æŒä¼˜å…ˆçº§é˜Ÿåˆ—
- å¤±è´¥ä»»åŠ¡è‡ªåŠ¨é‡è¯•

**TMCå¯å€Ÿé‰´ï¼š**

```python
# å¢å¼º app/backend/services/media_monitor_service.py

import heapq
from dataclasses import dataclass, field
from typing import Any

@dataclass(order=True)
class PriorityTask:
    """ä¼˜å…ˆçº§ä»»åŠ¡"""
    priority: int
    task_data: Any = field(compare=False)

class EnhancedMediaMonitorService(MediaMonitorService):
    """å¢å¼ºçš„åª’ä½“ç›‘æ§æœåŠ¡ - æ”¯æŒä¼˜å…ˆçº§é˜Ÿåˆ—"""
    
    def __init__(self):
        super().__init__()
        self.priority_queue = []  # ä¼˜å…ˆçº§é˜Ÿåˆ—
        self.queue_lock = asyncio.Lock()
    
    async def add_download_task_with_priority(self, task_data: Dict, priority: int = 0):
        """æ·»åŠ å¸¦ä¼˜å…ˆçº§çš„ä¸‹è½½ä»»åŠ¡"""
        async with self.queue_lock:
            heapq.heappush(
                self.priority_queue,
                PriorityTask(priority=-priority, task_data=task_data)  # è´Ÿæ•°ä½¿å¤§å€¼ä¼˜å…ˆ
            )
            logger.info(f"æ·»åŠ ä¼˜å…ˆçº§ä»»åŠ¡: priority={priority}, file={task_data['file_name']}")
    
    async def _download_worker(self, worker_id: int):
        """ä¸‹è½½å·¥ä½œçº¿ç¨‹ï¼ˆæ”¯æŒä¼˜å…ˆçº§ï¼‰"""
        logger.info(f"ğŸ‘· ä¸‹è½½å·¥ä½œçº¿ç¨‹ #{worker_id+1} å·²å¯åŠ¨")
        
        while self.is_running:
            try:
                # ä¼˜å…ˆä»ä¼˜å…ˆçº§é˜Ÿåˆ—è·å–
                task = None
                async with self.queue_lock:
                    if self.priority_queue:
                        priority_task = heapq.heappop(self.priority_queue)
                        task = priority_task.task_data
                
                # å¦‚æœä¼˜å…ˆçº§é˜Ÿåˆ—ä¸ºç©ºï¼Œä»æ™®é€šé˜Ÿåˆ—è·å–
                if not task:
                    task = await asyncio.wait_for(
                        self.download_queue.get(),
                        timeout=1.0
                    )
                
                logger.info(f"[Worker #{worker_id+1}] å¼€å§‹ä¸‹è½½: {task['file_name']}")
                
                # æ‰§è¡Œä¸‹è½½
                await self._execute_download(task)
                
                # æ ‡è®°ä»»åŠ¡å®Œæˆ
                if not task.get('from_priority_queue'):
                    self.download_queue.task_done()
                
            except asyncio.TimeoutError:
                continue
            except Exception as e:
                logger.error(f"[Worker #{worker_id+1}] ä¸‹è½½ä»»åŠ¡å¤±è´¥: {e}")
```

### 5.3 ç”¨æˆ·ä½“éªŒå±‚é¢

#### 5.3.1 è¿›åº¦é€šçŸ¥

**115Botçš„å®ç°ï¼š**
- å®æ—¶æ¨é€ä¸‹è½½è¿›åº¦
- å®Œæˆåå‘é€é€šçŸ¥
- æ”¯æŒè‡ªå®šä¹‰é€šçŸ¥æ¨¡æ¿

**TMCå¯å€Ÿé‰´ï¼š**

```python
# åˆ›å»º app/backend/services/notification_service.py

class NotificationService:
    """é€šçŸ¥æœåŠ¡ - å€Ÿé‰´115Bot"""
    
    async def send_download_progress(self, task: DownloadTask, progress: int):
        """å‘é€ä¸‹è½½è¿›åº¦é€šçŸ¥"""
        # åªåœ¨ç‰¹å®šè¿›åº¦ç‚¹å‘é€ï¼ˆ10%, 25%, 50%, 75%, 90%, 100%ï¼‰
        milestones = [10, 25, 50, 75, 90, 100]
        if progress not in milestones:
            return
        
        message = f"""
ğŸ“¥ ä¸‹è½½è¿›åº¦æ›´æ–°

æ–‡ä»¶å: {task.file_name}
è¿›åº¦: {progress}%
å·²ä¸‹è½½: {task.downloaded_bytes / 1024 / 1024:.2f}MB
æ€»å¤§å°: {task.total_bytes / 1024 / 1024:.2f}MB
é€Ÿåº¦: {task.download_speed_mbps}MB/s
        """
        
        # å‘é€åˆ°Telegramï¼ˆå¦‚æœé…ç½®äº†é€šçŸ¥é¢‘é“ï¼‰
        await self.send_telegram_notification(message)
    
    async def send_task_completed(self, task: DownloadTask, media_file: MediaFile):
        """å‘é€ä»»åŠ¡å®Œæˆé€šçŸ¥"""
        message = f"""
âœ… ä¸‹è½½å®Œæˆ

æ–‡ä»¶å: {task.file_name}
å¤§å°: {task.file_size_mb}MB
ç±»å‹: {task.file_type}
æ¥æº: {media_file.source_chat}
å½’æ¡£è·¯å¾„: {media_file.final_path or media_file.pan115_path}
ç”¨æ—¶: {(task.completed_at - task.started_at).total_seconds():.1f}ç§’
        """
        
        await self.send_telegram_notification(message)
```

#### 5.3.2 å‘½ä»¤äº¤äº’

**115Botçš„å®ç°ï¼š**
- ä¸°å¯Œçš„å‘½ä»¤ç³»ç»Ÿ
- æ”¯æŒå†…è”æŒ‰é’®
- äº¤äº’å¼é…ç½®

**TMCå¯å€Ÿé‰´ï¼š**

```python
# åœ¨ app/backend/enhanced_bot.py ä¸­æ–°å¢å‘½ä»¤

async def handle_media_commands(self, message):
    """å¤„ç†åª’ä½“ç®¡ç†å‘½ä»¤ï¼ˆå€Ÿé‰´115Botï¼‰"""
    text = message.text
    
    if text == '/media_stats':
        # ç»Ÿè®¡ä¿¡æ¯
        stats = await self.get_media_statistics()
        reply = f"""
ğŸ“Š åª’ä½“ç®¡ç†ç»Ÿè®¡

æ€»ä¸‹è½½: {stats['total_downloads']}ä¸ª
æ€»å¤§å°: {stats['total_size_gb']:.2f}GB
æˆåŠŸç‡: {stats['success_rate']:.1f}%
ä»Šæ—¥ä¸‹è½½: {stats['today_downloads']}ä¸ª

å­˜å‚¨ä½¿ç”¨: {stats['storage_used_gb']:.2f}GB / {stats['storage_total_gb']}GB
å‰©ä½™ç©ºé—´: {stats['storage_remain_gb']:.2f}GB
        """
        await message.reply(reply)
    
    elif text == '/media_rules':
        # ç›‘æ§è§„åˆ™åˆ—è¡¨
        rules = await self.get_active_rules()
        reply = "ğŸ“‹ æ´»è·ƒç›‘æ§è§„åˆ™:\n\n"
        for rule in rules:
            reply += f"â€¢ {rule.name} (ID: {rule.id})\n"
            reply += f"  æ¥æº: {rule.source_chats}\n"
            reply += f"  å·²ä¸‹è½½: {rule.total_downloaded}ä¸ª\n\n"
        await message.reply(reply)
    
    elif text.startswith('/media_pause'):
        # æš‚åœè§„åˆ™
        rule_id = int(text.split()[1])
        await self.pause_media_rule(rule_id)
        await message.reply(f"âœ… å·²æš‚åœè§„åˆ™ #{rule_id}")
    
    elif text.startswith('/media_resume'):
        # æ¢å¤è§„åˆ™
        rule_id = int(text.split()[1])
        await self.resume_media_rule(rule_id)
        await message.reply(f"âœ… å·²æ¢å¤è§„åˆ™ #{rule_id}")
```

---

## 6. åŠŸèƒ½å¯¹æ¯”ä¸å·®å¼‚

### 6.1 åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | 115Bot | TMCå½“å‰ | TMCå¯å¢å¼º |
|------|--------|---------|-----------|
| **æ–‡ä»¶ä¸‹è½½** |
| Telegramåª’ä½“ä¸‹è½½ | âœ… | âœ… | - |
| 115ç¦»çº¿ä»»åŠ¡ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| ç£åŠ›é“¾ä¸‹è½½ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| æ–­ç‚¹ç»­ä¼  | âœ… | âš ï¸ éƒ¨åˆ†æ”¯æŒ | ğŸ”„ å¯å¢å¼º |
| **æ–‡ä»¶ç®¡ç†** |
| è‡ªåŠ¨å½’æ¡£ | âœ… | âœ… | - |
| æ™ºèƒ½é‡å‘½å | âœ… | âœ… | - |
| æ‰¹é‡è§£å‹ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| å¹¿å‘Šè¿‡æ»¤ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| STRMç”Ÿæˆ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| **ä»»åŠ¡ç®¡ç†** |
| ä»»åŠ¡é˜Ÿåˆ— | âœ… | âœ… | - |
| ä¼˜å…ˆçº§é˜Ÿåˆ— | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| å®šæ—¶ä»»åŠ¡ | âœ… | âš ï¸ ç®€å• | ğŸ”„ å¯å¢å¼º |
| çŠ¶æ€è½®è¯¢ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| **é€šçŸ¥ç³»ç»Ÿ** |
| è¿›åº¦é€šçŸ¥ | âœ… | âš ï¸ ç®€å• | ğŸ”„ å¯å¢å¼º |
| å®Œæˆé€šçŸ¥ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| é”™è¯¯æŠ¥å‘Š | âœ… | âš ï¸ ç®€å• | ğŸ”„ å¯å¢å¼º |
| **115ç½‘ç›˜** |
| æ–‡ä»¶ä¸Šä¼  | âœ… | âœ… | - |
| ç§’ä¼ æ£€æµ‹ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| ç¦»çº¿ä»»åŠ¡ | âœ… | âŒ | ğŸ”„ å¯å€Ÿé‰´ |
| æ–‡ä»¶æ“ä½œ | âœ… | âš ï¸ åŸºç¡€ | ğŸ”„ å¯å¢å¼º |

### 6.2 TMCçš„ç‹¬ç‰¹ä¼˜åŠ¿

| åŠŸèƒ½ | TMCç‹¬æœ‰ | è¯´æ˜ |
|------|---------|------|
| Webç®¡ç†ç•Œé¢ | âœ… | 115Botåªæœ‰Telegramäº¤äº’ |
| å¤šå®¢æˆ·ç«¯ç®¡ç† | âœ… | æ”¯æŒå¤šä¸ªTelegramè´¦å· |
| æ¶ˆæ¯è½¬å‘ | âœ… | 115Botä¸æ”¯æŒ |
| ç”¨æˆ·æƒé™ç³»ç»Ÿ | âœ… | æ›´å®Œå–„çš„æƒé™ç®¡ç† |
| å…ƒæ•°æ®æå– | âœ… | æ›´è¯¦ç»†çš„è§†é¢‘å…ƒæ•°æ® |
| æ•°æ®åº“ç®¡ç† | âœ… | å®Œæ•´çš„å…³ç³»å‹æ•°æ®åº“ |
| APIæ¥å£ | âœ… | RESTful API |

---

## 7. ä¼˜åŒ–å»ºè®®

### 7.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

#### 7.1.1 å¢å¼ºæ–‡ä»¶è¿‡æ»¤

**ç›®æ ‡ï¼š** å€Ÿé‰´115Botçš„å¹¿å‘Šæ–‡ä»¶è¿‡æ»¤

**å®ç°ï¼š**

```python
# åœ¨ app/backend/utils/media_filters.py ä¸­æ–°å¢

class AdvancedMediaFilter:
    """é«˜çº§åª’ä½“è¿‡æ»¤å™¨ - å€Ÿé‰´115Bot"""
    
    # å¹¿å‘Šæ–‡ä»¶ç‰¹å¾åº“
    AD_PATTERNS = [
        r'www\.',
        r'\.url$',
        r'\.txt$',
        r'\.nfo$',
        r'å¹¿å‘Š',
        r'æ¨å¹¿',
        r'sample',
        r'é¢„è§ˆ',
    ]
    
    # æœ€å°æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
    MIN_VIDEO_SIZE = 1    # è§†é¢‘è‡³å°‘1MB
    MIN_AUDIO_SIZE = 0.1  # éŸ³é¢‘è‡³å°‘100KB
    
    @classmethod
    def is_ad_file(cls, filename: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦ä¸ºå¹¿å‘Šæ–‡ä»¶"""
        filename_lower = filename.lower()
        for pattern in cls.AD_PATTERNS:
            if re.search(pattern, filename_lower):
                return True
        return False
    
    @classmethod
    def is_valid_media(cls, file_type: str, file_size_mb: float) -> bool:
        """åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰æ•ˆåª’ä½“æ–‡ä»¶"""
        if file_type == 'video' and file_size_mb < cls.MIN_VIDEO_SIZE:
            return False
        if file_type == 'audio' and file_size_mb < cls.MIN_AUDIO_SIZE:
            return False
        return True
```

**å·¥ä½œé‡ï¼š** 2-3å¤©

#### 7.1.2 ä¼˜åŒ–è¿›åº¦é€šçŸ¥

**ç›®æ ‡ï¼š** å®æ—¶æ¨é€ä¸‹è½½è¿›åº¦

**å®ç°ï¼š**

```python
# ä¿®æ”¹ app/backend/services/media_monitor_service.py

async def _execute_download(self, task_data: Dict[str, Any]):
    """æ‰§è¡Œä¸‹è½½ä»»åŠ¡ï¼ˆå¢å¼ºè¿›åº¦é€šçŸ¥ï¼‰"""
    # ... ç°æœ‰ä»£ç  ...
    
    # å¢å¼ºè¿›åº¦å›è°ƒ
    def progress_callback(current, total):
        percent = (current / total * 100) if total > 0 else 0
        
        # æ¯10%å‘é€ä¸€æ¬¡é€šçŸ¥
        milestone = int(percent / 10) * 10
        if milestone > last_milestone[0]:
            last_milestone[0] = milestone
            
            # å‘é€Telegramé€šçŸ¥
            asyncio.create_task(
                notification_service.send_progress_update(
                    task_id=task.id,
                    progress=milestone,
                    current_mb=current / 1024 / 1024,
                    total_mb=total / 1024 / 1024
                )
            )
```

**å·¥ä½œé‡ï¼š** 1-2å¤©

### 7.2 ä¸­æœŸä¼˜åŒ–ï¼ˆ2-4å‘¨ï¼‰

#### 7.2.1 å®ç°ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

**ç›®æ ‡ï¼š** å€Ÿé‰´115Botçš„å®šæ—¶ä»»åŠ¡è°ƒåº¦

**å®ç°æ­¥éª¤ï¼š**
1. é›†æˆAPScheduler
2. å®ç°å®šæ—¶æ¸…ç†
3. å®ç°çŠ¶æ€æ£€æŸ¥
4. å®ç°ç»Ÿè®¡æŠ¥å‘Š

**å·¥ä½œé‡ï¼š** 5-7å¤©

#### 7.2.2 å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—

**ç›®æ ‡ï¼š** æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§

**å®ç°æ­¥éª¤ï¼š**
1. ä¿®æ”¹ä¸‹è½½é˜Ÿåˆ—ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—
2. æ·»åŠ ä¼˜å…ˆçº§è®¾ç½®æ¥å£
3. å‰ç«¯æ”¯æŒä¼˜å…ˆçº§è°ƒæ•´

**å·¥ä½œé‡ï¼š** 3-5å¤©

### 7.3 é•¿æœŸä¼˜åŒ–ï¼ˆ1-2ä¸ªæœˆï¼‰

#### 7.3.1 å®ç°ç¦»çº¿ä»»åŠ¡ç›‘æ§

**ç›®æ ‡ï¼š** æ”¯æŒç›‘æ§115ç¦»çº¿ä»»åŠ¡

**å®ç°æ­¥éª¤ï¼š**
1. åˆ›å»ºç¦»çº¿ä»»åŠ¡è¡¨
2. å®ç°ä»»åŠ¡è½®è¯¢
3. å®ç°è‡ªåŠ¨åå¤„ç†
4. å‰ç«¯ç®¡ç†ç•Œé¢

**å·¥ä½œé‡ï¼š** 10-15å¤©

#### 7.3.2 å®ç°STRMæ–‡ä»¶ç”Ÿæˆ

**ç›®æ ‡ï¼š** ä¸ºè§†é¢‘ç”ŸæˆSTRMæ–‡ä»¶

**å®ç°æ­¥éª¤ï¼š**
1. å®ç°STRMæ–‡ä»¶ç”Ÿæˆå™¨
2. é›†æˆåˆ°å½’æ¡£æµç¨‹
3. æ”¯æŒEmby/Jellyfin/Plex

**å·¥ä½œé‡ï¼š** 5-7å¤©

---

## 8. æ€»ç»“

### 8.1 æ ¸å¿ƒå€Ÿé‰´ç‚¹

1. **ç¦»çº¿ä»»åŠ¡ç›‘æ§** â­â­â­â­â­
   - å®šæ—¶è½®è¯¢æœºåˆ¶
   - è‡ªåŠ¨åå¤„ç†
   - æ™ºèƒ½é‡è¯•

2. **æ™ºèƒ½æ–‡ä»¶è¿‡æ»¤** â­â­â­â­
   - å¹¿å‘Šæ–‡ä»¶è¯†åˆ«
   - å¤§å°è¿‡æ»¤
   - æ‰©å±•åè¿‡æ»¤

3. **ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ** â­â­â­â­
   - å®šæ—¶ä»»åŠ¡
   - è‡ªåŠ¨æ¸…ç†
   - ç»Ÿè®¡æŠ¥å‘Š

4. **ä¼˜å…ˆçº§é˜Ÿåˆ—** â­â­â­
   - ä»»åŠ¡ä¼˜å…ˆçº§
   - æ™ºèƒ½è°ƒåº¦
   - èµ„æºåˆ†é…

5. **è¿›åº¦é€šçŸ¥** â­â­â­
   - å®æ—¶æ¨é€
   - é‡Œç¨‹ç¢‘é€šçŸ¥
   - å®Œæˆé€šçŸ¥

### 8.2 å®æ–½è·¯çº¿å›¾

```
é˜¶æ®µ1ï¼ˆç¬¬1-2å‘¨ï¼‰ï¼šåŸºç¡€å¢å¼º
â”œâ”€ æ–‡ä»¶è¿‡æ»¤å¢å¼º
â”œâ”€ è¿›åº¦é€šçŸ¥ä¼˜åŒ–
â””â”€ æ‰¹é‡æ“ä½œæ”¯æŒ

é˜¶æ®µ2ï¼ˆç¬¬3-4å‘¨ï¼‰ï¼šæ¶æ„ä¼˜åŒ–
â”œâ”€ ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ
â”œâ”€ ä¼˜å…ˆçº§é˜Ÿåˆ—
â””â”€ å®šæ—¶æ¸…ç†

é˜¶æ®µ3ï¼ˆç¬¬5-8å‘¨ï¼‰ï¼šé«˜çº§åŠŸèƒ½
â”œâ”€ ç¦»çº¿ä»»åŠ¡ç›‘æ§
â”œâ”€ STRMæ–‡ä»¶ç”Ÿæˆ
â””â”€ æ™ºèƒ½åå¤„ç†
```

### 8.3 é¢„æœŸæ”¶ç›Š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| æ–‡ä»¶è¿‡æ»¤å‡†ç¡®ç‡ | 70% | 95% | +35% |
| ä»»åŠ¡ç®¡ç†æ•ˆç‡ | 60% | 90% | +50% |
| ç”¨æˆ·ä½“éªŒè¯„åˆ† | 7/10 | 9/10 | +28% |
| ç³»ç»Ÿè‡ªåŠ¨åŒ–ç¨‹åº¦ | 50% | 85% | +70% |

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2025-01-12  
**ä½œè€…ï¼š** AI Assistant  
**å®¡æ ¸çŠ¶æ€ï¼š** å¾…å®¡æ ¸

---

## é™„å½•

### A. å‚è€ƒèµ„æº

- [115Bot Docker Hub](https://hub.docker.com/r/len996/115bot)
- [Telegram-115bot GitHub](https://github.com/qiqiandfei/Telegram-115bot)
- [115Botéƒ¨ç½²æ•™ç¨‹](https://www.xix.lol/archives/1717259753539)

### B. ç›¸å…³æ–‡æ¡£

- [TMCæ··åˆæ¶æ„å¼€å‘æ–‡æ¡£](./HYBRID_ARCHITECTURE_DEVELOPMENT.md)
- [TMCèµ„æºç›‘æ§æœåŠ¡è®¾è®¡](./RESOURCE_MONITOR_DESIGN.md)

### C. æŠ€æœ¯æ ˆå¯¹æ¯”

| æŠ€æœ¯ | 115Bot | TMC |
|------|--------|-----|
| åç«¯è¯­è¨€ | Java/Python | Python |
| Webæ¡†æ¶ | - | FastAPI |
| æ•°æ®åº“ | SQLite | SQLite |
| å‰ç«¯ | - | React + Ant Design |
| Telegramåº“ | python-telegram-bot | Telethon |
| ä»»åŠ¡è°ƒåº¦ | Spring Scheduler | APScheduler |
| éƒ¨ç½²æ–¹å¼ | Docker | Docker Compose |


