# å¯¼å…¥å¯¼å‡ºåŠŸèƒ½å®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„æ•°æ®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ï¼Œæ”¯æŒè§„åˆ™é…ç½®ã€æ—¥å¿—è®°å½•å’ŒèŠå¤©åˆ—è¡¨çš„å¤‡ä»½ä¸æ¢å¤ã€‚

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. è½¬å‘è§„åˆ™ (Rules)

#### å¯¼å‡ºè§„åˆ™
- **ç«¯ç‚¹**: `POST /api/rules/export`
- **è®¤è¯**: éœ€è¦ç™»å½•
- **è¯·æ±‚ä½“**:
  ```json
  {
    "ids": [1, 2, 3]  // å¯é€‰ï¼ŒæŒ‡å®šè¦å¯¼å‡ºçš„è§„åˆ™IDï¼Œç•™ç©ºå¯¼å‡ºå…¨éƒ¨
  }
  ```
- **å“åº”**: JSONæ–‡ä»¶ä¸‹è½½ï¼ŒåŒ…å«å®Œæ•´çš„è§„åˆ™é…ç½®ã€å…³é”®è¯å’Œæ›¿æ¢è§„åˆ™

#### å¯¼å…¥è§„åˆ™
- **ç«¯ç‚¹**: `POST /api/rules/import`
- **è®¤è¯**: éœ€è¦ç™»å½•
- **è¯·æ±‚ä½“**:
  ```json
  {
    "data": [
      {
        "name": "è§„åˆ™åç§°",
        "source_chat_id": "æºèŠå¤©ID",
        "target_chat_id": "ç›®æ ‡èŠå¤©ID",
        "is_active": true,
        "keywords": [...],
        "replacements": [...]
      }
    ]
  }
  ```
- **å“åº”**: å¯¼å…¥ç»“æœç»Ÿè®¡

#### å¯¼å‡ºå­—æ®µè¯´æ˜
```json
{
  "id": 1,
  "name": "è§„åˆ™åç§°",
  "source_chat_id": "æºèŠå¤©ID",
  "source_chat_name": "æºèŠå¤©åç§°",
  "target_chat_id": "ç›®æ ‡èŠå¤©ID",
  "target_chat_name": "ç›®æ ‡èŠå¤©åç§°",
  "is_active": true,
  "enable_keyword_filter": false,
  "enable_regex_replace": false,
  "client_id": "main_user",
  "client_type": "user",
  
  // æ¶ˆæ¯ç±»å‹å¼€å…³
  "enable_text": true,
  "enable_media": true,
  "enable_photo": true,
  "enable_video": true,
  "enable_document": true,
  "enable_audio": true,
  "enable_voice": true,
  "enable_sticker": false,
  "enable_animation": true,
  "enable_webpage": true,
  
  // é«˜çº§è®¾ç½®
  "forward_delay": 0,
  "max_message_length": 4096,
  "enable_link_preview": true,
  "time_filter_type": "after_start",
  "start_time": "2025-01-01T00:00:00",
  "end_time": null,
  
  // å»é‡è®¾ç½®
  "enable_deduplication": false,
  "dedup_time_window": 3600,
  "dedup_check_content": true,
  "dedup_check_media": true,
  
  // å‘é€è€…è¿‡æ»¤
  "enable_sender_filter": false,
  "sender_filter_mode": "whitelist",
  "sender_whitelist": "[...]",
  "sender_blacklist": "[...]",
  
  // å…³é”®è¯
  "keywords": [
    {
      "keyword": "å…³é”®è¯",
      "is_regex": false,
      "is_exclude": false,
      "case_sensitive": false
    }
  ],
  
  // æ›¿æ¢è§„åˆ™
  "replacements": [
    {
      "name": "æ›¿æ¢è§„åˆ™åç§°",
      "pattern": "åŒ¹é…æ¨¡å¼",
      "replacement": "æ›¿æ¢å†…å®¹",
      "priority": 0,
      "is_regex": true,
      "is_active": true,
      "is_global": false
    }
  ],
  
  // æ—¶é—´æˆ³
  "created_at": "2025-01-01T00:00:00",
  "updated_at": "2025-01-01T00:00:00"
}
```

---

### 2. æ¶ˆæ¯æ—¥å¿— (Logs)

#### å¯¼å‡ºæ—¥å¿—
- **ç«¯ç‚¹**: `POST /api/logs/export`
- **è®¤è¯**: éœ€è¦ç™»å½•
- **è¯·æ±‚ä½“**: æ”¯æŒç­›é€‰æ¡ä»¶
  ```json
  {
    "status": "success",           // å¯é€‰ï¼šsuccess/failed
    "rule_id": 1,                  // å¯é€‰ï¼šè§„åˆ™ID
    "start_date": "2025-01-01",    // å¯é€‰ï¼šå¼€å§‹æ—¥æœŸ
    "end_date": "2025-01-31"       // å¯é€‰ï¼šç»“æŸæ—¥æœŸ
  }
  ```
- **å“åº”**: JSONæ–‡ä»¶ä¸‹è½½ï¼ŒåŒ…å«ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰æ—¥å¿—

#### å¯¼å…¥æ—¥å¿—
- **ç«¯ç‚¹**: `POST /api/logs/import`
- **è®¤è¯**: éœ€è¦ç™»å½•
- **è¯·æ±‚ä½“**:
  ```json
  {
    "data": [
      {
        "rule_id": 1,
        "source_chat_id": "æºèŠå¤©ID",
        "source_message_id": 123,
        "target_chat_id": "ç›®æ ‡èŠå¤©ID",
        "status": "success",
        ...
      }
    ]
  }
  ```
- **ç”¨é€”**: ç”¨äºæ¢å¤å†å²æ—¥å¿—è®°å½•ã€æ•°æ®è¿ç§»

#### å¯¼å‡ºå­—æ®µè¯´æ˜
```json
{
  "id": 1,
  "rule_id": 1,
  "rule_name": "è§„åˆ™åç§°",
  
  // æºæ¶ˆæ¯ä¿¡æ¯
  "source_chat_id": "æºèŠå¤©ID",
  "source_chat_name": "æºèŠå¤©åç§°",
  "source_message_id": 123,
  
  // ç›®æ ‡æ¶ˆæ¯ä¿¡æ¯
  "target_chat_id": "ç›®æ ‡èŠå¤©ID",
  "target_chat_name": "ç›®æ ‡èŠå¤©åç§°",
  "target_message_id": 456,
  
  // æ¶ˆæ¯å†…å®¹
  "original_text": "åŸå§‹æ–‡æœ¬",
  "processed_text": "å¤„ç†åæ–‡æœ¬",
  "media_type": "photo",
  
  // å»é‡ä¿¡æ¯
  "content_hash": "å†…å®¹å“ˆå¸Œå€¼",
  "media_hash": "åª’ä½“å“ˆå¸Œå€¼",
  "sender_id": "å‘é€è€…ID",
  "sender_username": "å‘é€è€…ç”¨æˆ·å",
  
  // çŠ¶æ€ä¿¡æ¯
  "status": "success",
  "error_message": null,
  "processing_time": 123,
  
  // æ—¶é—´æˆ³
  "created_at": "2025-01-01T12:00:00"
}
```

---

### 3. èŠå¤©åˆ—è¡¨ (Chats)

#### å¯¼å‡ºèŠå¤©åˆ—è¡¨
- **ç«¯ç‚¹**: `POST /api/chats/export`
- **è®¤è¯**: éœ€è¦ç™»å½•
- **å“åº”**: JSONæ–‡ä»¶ä¸‹è½½ï¼ŒåŒ…å«å½“å‰æ‰€æœ‰èŠå¤©ä¿¡æ¯

#### å¯¼å…¥èŠå¤©åˆ—è¡¨
- **ç«¯ç‚¹**: `POST /api/chats/import`
- **è®¤è¯**: éœ€è¦ç™»å½•
- **è¯·æ±‚ä½“**:
  ```json
  {
    "data": [
      {
        "id": "èŠå¤©ID",
        "name": "èŠå¤©åç§°",
        "type": "channel/group/private",
        ...
      }
    ]
  }
  ```
- **æ³¨æ„**: 
  - èŠå¤©åˆ—è¡¨æ˜¯ä»Telegramå®æ—¶åŒæ­¥çš„
  - å¯¼å…¥åŠŸèƒ½ä»…ç”¨äºå¤‡ä»½å‚è€ƒï¼Œä¸ä¼šå½±å“å®é™…çš„èŠå¤©åˆ—è¡¨
  - å®é™…èŠå¤©åˆ—è¡¨ä»ç„¶ä»Telegram APIè·å–

---

## ğŸ”„ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: å¤‡ä»½é…ç½®
1. å®šæœŸå¯¼å‡ºè§„åˆ™é…ç½®
2. ä¿å­˜åˆ°å®‰å…¨ä½ç½®
3. éœ€è¦æ—¶æ¢å¤

### åœºæ™¯2: è¿ç§»åˆ°æ–°ç³»ç»Ÿ
1. åœ¨æ—§ç³»ç»Ÿå¯¼å‡ºè§„åˆ™
2. åœ¨æ–°ç³»ç»Ÿå¯¼å…¥è§„åˆ™
3. éªŒè¯è§„åˆ™æ˜¯å¦æ­£å¸¸å·¥ä½œ

### åœºæ™¯3: åˆ†äº«é…ç½®æ¨¡æ¿
1. å¯¼å‡ºç²¾å¿ƒé…ç½®çš„è§„åˆ™
2. åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·
3. å…¶ä»–ç”¨æˆ·å¯¼å…¥åä¿®æ”¹æº/ç›®æ ‡èŠå¤©

### åœºæ™¯4: æ•°æ®åˆ†æ
1. å¯¼å‡ºæ—¥å¿—è®°å½•
2. ä½¿ç”¨Excel/Pythonè¿›è¡Œåˆ†æ
3. ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š

### åœºæ™¯5: æ•…éšœæ¢å¤
1. ç³»ç»Ÿæ•…éšœå‰æœ‰å¤‡ä»½
2. å¯¼å…¥å¤‡ä»½æ¢å¤é…ç½®
3. å¿«é€Ÿæ¢å¤æœåŠ¡

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. å®šæœŸå¤‡ä»½
```bash
# å»ºè®®æ¯å‘¨å¤‡ä»½ä¸€æ¬¡è§„åˆ™é…ç½®
# æ–‡ä»¶ååŒ…å«æ—¥æœŸä¾¿äºç®¡ç†
rules_backup_2025-01-01.json
```

### 2. å¯¼å…¥å‰éªŒè¯
- æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å­—æ®µåç§°åŒ¹é…
- æµ‹è¯•å°æ‰¹é‡å¯¼å…¥

### 3. æ‰¹é‡å¯¼å…¥
- æ”¯æŒä¸€æ¬¡å¯¼å…¥å¤šæ¡è®°å½•
- å¤±è´¥çš„è®°å½•ä¼šè·³è¿‡ï¼Œä¸å½±å“å…¶ä»–è®°å½•
- æŸ¥çœ‹è¿”å›çš„æˆåŠŸ/å¤±è´¥ç»Ÿè®¡

### 4. æ•°æ®æ¸…ç†
- å¯¼å‡ºå‰å¯ä»¥ç­›é€‰éœ€è¦çš„æ•°æ®
- é¿å…å¯¼å‡ºæ•æ„Ÿä¿¡æ¯
- å®šæœŸæ¸…ç†æ—§æ—¥å¿—

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¯¼å…¥è§„åˆ™æ—¶
- **èŠå¤©ID**: éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸ºæ–°ç³»ç»Ÿä¸­çš„å®é™…ID
- **å®¢æˆ·ç«¯ID**: ç¡®ä¿ç›®æ ‡ç³»ç»Ÿæœ‰å¯¹åº”çš„å®¢æˆ·ç«¯
- **æ—¶é—´å­—æ®µ**: ä½¿ç”¨ISOæ ¼å¼ `2025-01-01T12:00:00`
- **åµŒå¥—å¯¹è±¡**: keywordså’Œreplacementsä¼šè‡ªåŠ¨å…³è”

### å¯¼å…¥æ—¥å¿—æ—¶
- ä¸ä¼šæ£€æŸ¥æ¶ˆæ¯IDæ˜¯å¦çœŸå®å­˜åœ¨
- ä»…ç”¨äºå†å²è®°å½•æ¢å¤
- created_atä¼šä¿ç•™åŸå§‹æ—¶é—´

### å¯¼å…¥èŠå¤©åˆ—è¡¨æ—¶
- ä»…ä½œä¸ºå¤‡ä»½å‚è€ƒ
- ä¸å½±å“å®é™…çš„TelegramèŠå¤©åˆ—è¡¨
- å®é™…èŠå¤©åˆ—è¡¨ä»APIåŒæ­¥

---

## ğŸ› ï¸ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯

#### 1. è®¤è¯å¤±è´¥
```json
{
  "success": false,
  "message": "æœªæˆæƒ"
}
```
**è§£å†³**: ç¡®ä¿å·²ç™»å½•ï¼Œtokenæœ‰æ•ˆ

#### 2. æ•°æ®æ ¼å¼é”™è¯¯
```json
{
  "success": false,
  "message": "å¯¼å…¥æ•°æ®ä¸ºç©º"
}
```
**è§£å†³**: æ£€æŸ¥è¯·æ±‚ä½“æ ¼å¼ï¼Œç¡®ä¿dataå­—æ®µå­˜åœ¨

#### 3. å­—æ®µç¼ºå¤±
```
å¯¼å…¥è§„åˆ™å¤±è´¥ (è·³è¿‡): è§„åˆ™A - ç¼ºå°‘å¿…éœ€å­—æ®µ
```
**è§£å†³**: è¡¥å……å¿…éœ€å­—æ®µï¼ˆname, source_chat_id, target_chat_idï¼‰

#### 4. éƒ¨åˆ†å¯¼å…¥æˆåŠŸ
```json
{
  "success": true,
  "imported_count": 8,
  "message": "æˆåŠŸå¯¼å…¥ 8 æ¡è§„åˆ™ï¼ˆæ€»å…± 10 æ¡ï¼‰"
}
```
**è¯´æ˜**: æœ‰2æ¡è®°å½•å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—äº†è§£åŸå› 

---

## ğŸ” APIæµ‹è¯•ç¤ºä¾‹

### ä½¿ç”¨curlå¯¼å‡ºè§„åˆ™
```bash
curl -X POST http://localhost:9393/api/rules/export \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"ids": []}' \
  -o rules_backup.json
```

### ä½¿ç”¨curlå¯¼å…¥è§„åˆ™
```bash
curl -X POST http://localhost:9393/api/rules/import \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d @rules_backup.json
```

### ä½¿ç”¨curlå¯¼å‡ºæ—¥å¿—
```bash
curl -X POST http://localhost:9393/api/logs/export \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"start_date": "2025-01-01", "end_date": "2025-01-31"}' \
  -o logs_backup.json
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### å¯¼å‡ºæˆåŠŸå“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": [...],
  "message": "æˆåŠŸå¯¼å‡º 10 æ¡è§„åˆ™",
  "filename": "rules_export_20250109_220000.json"
}
```

### å¯¼å…¥æˆåŠŸå“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "imported_count": 10,
  "message": "æˆåŠŸå¯¼å…¥ 10 æ¡è§„åˆ™ï¼ˆæ€»å…± 10 æ¡ï¼‰"
}
```

---

## ğŸ¯ æ€»ç»“

æœ¬ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ï¼Œæ”¯æŒï¼š

âœ… **è§„åˆ™å¯¼å…¥å¯¼å‡º** - å®Œæ•´çš„é…ç½®å¤‡ä»½ä¸æ¢å¤  
âœ… **æ—¥å¿—å¯¼å…¥å¯¼å‡º** - å†å²è®°å½•åˆ†æä¸è¿ç§»  
âœ… **èŠå¤©å¯¼å…¥å¯¼å‡º** - èŠå¤©åˆ—è¡¨å¤‡ä»½å‚è€ƒ  

æ‰€æœ‰åŠŸèƒ½éƒ½ï¼š
- æ”¯æŒæ‰¹é‡æ“ä½œ
- åŒ…å«é”™è¯¯å¤„ç†
- éœ€è¦èº«ä»½è®¤è¯
- æä¾›è¯¦ç»†æ—¥å¿—
- è¿”å›ç»Ÿè®¡ä¿¡æ¯

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. åç«¯æ—¥å¿—ï¼š`logs/api.log`
2. æµè§ˆå™¨æ§åˆ¶å°
3. å¯¼å…¥å“åº”ä¸­çš„é”™è¯¯ä¿¡æ¯

æ›´æ–°æ—¥æœŸ: 2025-10-09
